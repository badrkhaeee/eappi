/* --------------------------------------------------------
    This is a part of the Sparx Systems Pro Cloud Server.
    Copyright (C) Sparx Systems Pty Ltd
    All rights reserved.
  
    This source code can be used only under terms and 
    conditions of the accompanying license agreement.
   -------------------------------------------------------- */
gc_sHelpLocation = 'http://sparxsystems.com/enterprise_architect_user_guide/14.0/';g_bIsLoggingOff = false;g_bJSDebugging = false;var g_TimerRef;var g_ChatTimerRef;var g_sLastGUID;var g_sLastHasChild;var g_sLastLinkType;var g_sLastHyper;var g_sLastName;var g_sLastImageURL;var g_bIsLoadGUID;g_bIsLoadGUID = false;$(document).ajaxComplete(function(event,xhr,ajaxSettings){if (ajaxSettings.doTimerCheck === false){return;}TimerCheck();});$(document).ajaxError(function(event,xhr,ajaxSettings,thrownError){var bStayVisible = false;if (ajaxSettings.suppressErrors){return;}if (xhr['responseText'] && xhr['responseText'].trim()){Write2Console('[' + xhr['status'] + '] ' + xhr['responseText'].trim());errorMsg = xhr['responseText'].trim();}else{Write2Console('[' + xhr['status'] + '] ' + xhr['statusText'].trim());errorMsg = xhr['statusText'].trim();}if ((xhr['status'] === 401) ||(xhr['status'] === 440) ||(xhr['status'] === 455) ||(xhr['status'] === 457) ||(xhr['status'] === 500)){bStayVisible = true;}sTargetID = "#login-error";if(xhr['status'] === 0){console.log('Unable to access URL');}else{WebeaErrorMessage(errorMsg,bStayVisible,sTargetID);}});$(document).mouseup(function (e){HideMenu(e,".hide-menu",".hide-menu");});$(document).mouseup(function (e){var container = $(".statusmenu-content");if ( !container.is(e.target) &&container.has(e.target).length === 0){container.hide();}var container = $(".prioritymenu-content");if ( !container.is(e.target) &&container.has(e.target).length === 0){container.hide();}$( "#webea-stereotype-list" ).hide();});function doc_keyUp(e){if ( $( "#main-contents" ).length ){if (e.keyCode == 27){if ($(".dialog-header-close-button").is(":visible")){$(".dialog-header-close-button").click();}if ($(".webea-dialog-close-button").is(":visible")){$(".webea-dialog-close-button").click();}}if (($("#main-page-overlay").is(":hidden")) &&(!$("input").is(":focus")) &&(!$("textarea").is(":focus"))){if (e.keyCode == 49){if ($("#statusbar-browser-button").is(":visible")){$("#statusbar-browser-button").click();}}if (e.keyCode == 50){if ($("#statusbar-properties-button").is(":visible")){$("#statusbar-properties-button").click();}}if (e.keyCode == 72){if ($("#navbar-home-button").is(":visible")){$("#navbar-home-button").click();}}if (e.keyCode == 83){if ($(".navbar-panel-right").hasClass("no-search")){WebeaErrorMessage('Search is not enabled for this Model');}else{OnClickCustomSearch();}}if (e.keyCode == 77){if ($(".browser-add-object").is(":visible")){$(".browser-add-object").click();}if ($(".package-add-object").is(":visible")){$(".package-add-object").click();}}if (e.keyCode == 87){if($(".watchlist-option")[0]){LoadObject('watchlist','','','','Watchlist','images/element16/watchlist.png');}else{WebeaErrorMessage('The Watchlist is not enabled for this Model');}}if (e.shiftKey && e.keyCode == 191){OpenKBShortcutDialog();}}}}jQuery.fn.sortElements = (function(){var sort = [].sort;return function(comparator,getSortable){getSortable = getSortable || function(){return this;};var placements = this.map(function(){var sortElement = getSortable.call(this),parentNode = sortElement.parentNode,nextSibling = parentNode.insertBefore(document.createTextNode(''),sortElement.nextSibling);return function(){if (parentNode === this){throw new Error("You can't sort elements if any one is a descendant of another.");}parentNode.insertBefore(this,nextSibling);parentNode.removeChild(nextSibling);};});return sort.call(this,comparator).each(function(i){placements[i].call(getSortable.call(this));});};})();function initialise_parameter_str(sParameter,sValue){if (typeof sParameter === 'undefined'){sParameter = sValue;}return sParameter;}function isDefined(x){var undefined;return x !== undefined;}function TimerCheck(){$.ajax({cache:false,url:"./data_api/get_setting.php",data:{varname:"timer_check"},doTimerCheck:false,success:function(response,status,xhr){var sData = String(response);var a = sData.split("&");var sAuthorized = a[0];var sSessionModelNo = a[1];sAuthorized = StrTrim(sAuthorized);if (typeof sAuthorized === 'undefined'){sAuthorized = '';}if (typeof sSessionModelNo === 'undefined'){sSessionModelNo = '';}if ( sAuthorized === '' || sAuthorized === 'false'){ShowFatalTimeout(false);}else{sSessionModelNo = StrTrim(sSessionModelNo);var sPageModelNo = $("#page-built-with-model-no").text();if ((sSessionModelNo !== '' && sPageModelNo !== '') && (sSessionModelNo !== sPageModelNo)){ShowFatalTimeout(false);}}}});}function ChatShowUsersMenu(){$(".user-chat-menu-contents").toggle('fade',{},300);}function ChatShowGroupsMenu(){$(".group-chat-menu-contents").toggle('fade',{},300);}function OnLogoff(event){g_bIsLoggingOff = true;ClearLastPage();document.location.href = "logout.php";}function ClearLastPage(){var sPageModelNo = $("#page-built-with-model-no").text();document.cookie = 'webea_lastpage_' + sPageModelNo + '=;path=/;';}function LoadNavbar(sGUID,sHasChild,sLinkType,sHyper,sName,sImageURL){var ele = $('#main-navbar');if ( ele != null ){$.ajax({type:"POST",cache:false,url:"navbar.php",data:{guid:sGUID,haschild:sHasChild,linktype:sLinkType,hyper:sHyper,name:sName,imageurl:sImageURL},beforeSend:function(){$("#navbar-busy-loader").show();},success:function(sNavBarHTML){document.getElementById('main-navbar').innerHTML = sNavBarHTML;LoadServerSystemoutput();if ( sGUID === 'searchresults' ){var sSearchCnt = $('#search-results-count').text();if (sSearchCnt !== ''){var sNavbarName = $('#navbar-current-name-text').text();sNavbarName = '<img alt="" src="images/spriteplaceholder.png" class="mainsprite-searchresults">&nbsp;' + sNavbarName + '&nbsp;(' + sSearchCnt + ')';document.getElementById('navbar-current-name-text').innerHTML = sNavbarName;}}else if ( sGUID === 'watchlistresults' ){var sSearchCnt = $('#watchlist-results-count').text();if (sSearchCnt !== ''){var sNavbarName = $('#navbar-current-name-text').text();sNavbarName = '<img alt="" src="images/spriteplaceholder.png" class="mainsprite-watchlistresults">&nbsp;' + sNavbarName + '&nbsp;(' + sSearchCnt + ')';document.getElementById('navbar-current-name-text').innerHTML = sNavbarName;}}if (sLinkType === 'favorites'){var sNavbarName = $('#navbar-current-name-text').text();sNavbarName = '<img alt="" src="images/spriteplaceholder.png" class="mainsprite-favorites">&nbsp;Favorites';document.getElementById('navbar-current-name-text').innerHTML = sNavbarName;}},error:function(jqXHR){Write2Console('LoadNavbar:' + jqXHR.statusText);},complete:function(){$("#navbar-busy-loader").hide();}});}}function FocusSearchTerm(){if ('ontouchstart' in document.documentElement ){return;}var field = $("input[id='search-criteria-field']",".search-form");if (field.length){field.focus();}}function OnClickSearchFor(element){if (typeof element === 'undefined'){return;}RefreshSearchForm();}function RefreshSearchForm(){var frmSearch = $(".search-form");if (typeof frmSearch === 'undefined'){return;}var bDisable = false;var fldCategory = $('#search-searchfor-combo',frmSearch).find(":selected");var fldCriteria = $("input[id='search-criteria-field']",".search-form");var fldSearchType = $('#search-searchtype-combo',frmSearch);if (typeof fldCategory !== 'undefined' && fldCategory.val() === 'discussion'){bDisable = true;}if (typeof fldCriteria !== 'undefined'){fldCriteria.attr('disabled',bDisable);}if (typeof fldSearchType !== 'undefined'){fldSearchType.attr('disabled',bDisable);}}$.fn.serializeAndEncode = function(){return $.map(this.serializeArray(),function(val){return [val.name,encodeURIComponent(val.value)].join('=');}).join('&');};function OnFormRunCustomSearch(event,sInName){event.preventDefault();var sPayload = 'search=custom&' + $(".search-form").serializeAndEncode();var category = $("[name=category]").val();var type = $("[name=type]").val();var when = $("[name=recent]").val();var settings ={'category':category,'type':type,'when':when};settingsJSON = JSON.stringify(settings);$.get('./data_api/set_setting.php?varname=search_settings&varval=' + settingsJSON,function (data){});sPayload = sPayload.replace("&recent=Any","");if ( sPayload !== '' ){LoadObject('searchresults','','',sPayload,sInName,'images/element16/searchresults.png');}}function OnClickCustomSearch(){$.ajax({type:"POST",cache:false,url:"mainsearch.php",data:{},beforeSend:function(){},success:function(response){$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();FocusSearchTerm();},error:function(jqXHR){},complete:function(){}});}function ChatShowDialog(bRefreshNotifications){var chatIsVisible = false;if($(".chat-menu-select-chat").is(":visible")){chatIsVisible = true;}$.ajax({type:"POST",cache:false,url:"chat.php",data:{},beforeSend:function(){if(!chatIsVisible){$("#full-busy-loader").show();}},success:function(response){$(".chat-menu-container").replaceWith($(response).find(".chat-menu-container"));$(".chat-messages-container").replaceWith($(response).find(".chat-messages-container"));$(".chat-send-btn").replaceWith($(response).find(".chat-send-btn"));$("#full-busy-loader").hide();if(bRefreshNotifications){ChatRefreshNotification();}},error:function(jqXHR){},complete:function(){}});}function OnChatSend(ele){event.preventDefault();var isMonitored = $(ele).attr("chat-monitor");var chatType = $(ele).attr("chat-type");if ((!isMonitored) && chatType === 'User'){ChatMonitorUserAndCreateMessage();}else{ChatCreateMessage();}}function ChatMonitorUserAndCreateMessage(){var sPayload = $(".chat-message-form").serialize();$.ajax({type:'POST',url:'./data_api/chat_monitor_group.php',beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){$.get('./data_api/set_setting.php?varname=chat_monitor&varval=' + 'true',function (data){ChatCreateMessage();});},complete:function(){$("#main-page-overlay").hide();$("#main-busy-loader1").hide();},error:function(jqXHR){WebeaErrorMessage(jqXHR.responseText);}});}function ChatMonitorGroup(ele){var groupName = $(ele).attr("chat-name");var isMonitored = $(ele).attr("chat-monitor");$.ajax({type:'POST',data:{group_name:groupName,group_monitor:isMonitored},url:'./data_api/chat_monitor_group.php',beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){ChatShowDialog(false);},complete:function(){$("#main-page-overlay").hide();$("#main-busy-loader1").hide();},error:function(jqXHR){WebeaErrorMessage(jqXHR.responseText);}});}function ChatSetDays(ele){var chatDays = $(ele).attr("chat-days");chatDays = encodeURIComponent(chatDays);$.get('./data_api/set_setting.php?varname=chat_days&varval=' + chatDays,function (data){ChatShowDialog(false);});}function ChatCreateMessage(){var sPayload = $(".chat-message-form").serialize();var chatName = $(".chat-menu-select-chat").attr("chat-name");var sInputText = $(".chat-message-input").val();if (sInputText === ''){$(".chat-message-input").focus();console.log('Chat input is empty');}else if (chatName === ''){WebeaErrorMessage('Please select a chat group or user');}else{$.ajax({type:'POST',url:'./data_api/chat_create_message.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){ChatShowDialog(false);$(".chat-message-input").val('');$(".chat-message-input").focus();},complete:function(){$("#main-page-overlay").hide();$("#main-busy-loader1").hide();},error:function(jqXHR){WebeaErrorMessage(jqXHR.responseText);}});}}function SelectChat(ele){var chatName = $(ele).attr("chat-name");var chatType = $(ele).attr("chat-type");var chatMonitor = $(ele).attr("chat-monitor");var varArray = [['chat_name',chatName],['chat_type',chatType],['chat_monitor',chatMonitor]];var settingsJSON = JSON.stringify(varArray);$("#chat-newmsg-context-menu").hide();$.get('./data_api/set_setting.php?json_var_array=' + settingsJSON,function (data){LoadObject('collaborate','','chat','','Collaborate','propsprite-discussion',false);});}function ChatRefreshNotification(){var contentBefore = $("#chat-newmsg-context-menu").html();$.ajax({type:"POST",cache:false,url:"chatnotification.php",beforeSend:function(){},success:function(response){if($(".chat-menu-select-chat").is(":visible")){var visibleChat = $(".chat-menu-select-chat").attr("chat-name");if($(response).find('[chat-name="'+visibleChat+'"]').length){var $response = $(response).find('[chat-name="'+visibleChat+'"]').remove().end();response = $($response)[0].outerHTML;if ($(response).find(".contextmenu-item").length === 0){response = '<div class="statusbar-chat-cell"></div>';}ChatShowDialog(false);}}if($("#chat-newmsg-context-menu").is(":visible")){$("#chat-newmsg-context-menu .contextmenu-items").replaceWith($(response).find("#chat-newmsg-context-menu .contextmenu-items"));}else{$(".statusbar-chat-cell").replaceWith(response);}var contentAfter = $("#chat-newmsg-context-menu").html();if(contentBefore !== contentAfter){var countBefore = $(contentBefore).length;var countAfter = $(contentAfter).length;if(countAfter >= countBefore){if ($("#chat-newmsg-context-menu").find(".contextmenu-item").length !== 0){$(".statusbar-chat-cell").addClass("blue-background",200).removeClass("blue-background",200).addClass("blue-background",200).removeClass("blue-background",200);}}}},error:function(jqXHR){},complete:function(){}});if($(".chat-menu-select-chat").is(":visible")){RefreshChatHistory();}}function RefreshChatHistory(){$.ajax({type:"POST",data:{linktype:'chat'},cache:false,url:"maincollaborate.php",beforeSend:function(){},success:function(response){ReplaceHTMLElement(response,'#chat-recent-tb');},error:function(jqXHR){},complete:function(){}});}function ShowCommentsAll(sGUID){var overlay;if($("#collab-comments-left").is(":visible"))overlay = $(".collab-left-overlay");elseoverlay = $("#main-busy-loader1");sResType = '';sLinkType = '';sObjectHyper = '';sCommentID = 'all';$.ajax({type:"POST",cache:false,url:"mainproperties.php",data:{objectguid:sGUID,restype:sResType,linktype:sLinkType,hyper:sObjectHyper,commentid:sCommentID},beforeSend:function(){overlay.show();},success:function(sHTML){ReplaceHTMLElement(sHTML,'#comments-section-contents');},error:function(jqXHR){Write2Console('LoadMinipropsObject:' + jqXHR.statusText);},complete:function(){overlay.hide();}});}function ReplaceHTMLElement(responseHTML,element){$(element).replaceWith($(responseHTML).find(element));}function OpenSelectObjectDialog(event,sGUID){if(event !== null){event.preventDefault();}$.ajax({type:"POST",cache:false,url:"selectobject.php",data:{objectguid:sGUID},beforeSend:function(){},success:function(response){$(".select-object-dialog").replaceWith(response);$("#main-page-overlay").show();$(".select-object-dialog").show();},error:function(jqXHR){},complete:function(){}});}function OnRunPredefinedSearch(sParameters,sInName){var sPayload = 'search=predefined&' + sParameters;sPayload = sPayload.replace("&recent=Any","");if ( sPayload !== '' ){LoadObject('searchresults','','',sPayload,sInName,'images/element16/searchresults.png',true);}}function OnFormRunAddRootPackage(event,bCloseDialog){bCloseDialog = bCloseDialog || false;event.preventDefault();SaveNicEditorData( 'add-element-notes-field' );var sPayload = 'action=addrootpackage&' + $(".add-element-form").serialize();var requestSettings ={type:'POST',url:'addrootpackageengine.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (sResults != ''){if (sResults.substr(0,8) === 'success:'){WebeaSuccessMessage(sResults.substr(9));g_bAfterRefresh = true;var sGUID = GetLastGUID();LoadMainContents(sGUID,false);if (bCloseDialog){CloseDialog();}}else{if (CheckFatalError(sResults) ){WebeaErrorMessage(sResults);}}LoadServerSystemoutput();}},complete:function(){$("#main-busy-loader1").hide();},error:function(jqXHR){}};$.ajax(requestSettings);}function OnFormRunAddElement(event,bCloseDialog){bCloseDialog = bCloseDialog || false;event.preventDefault();SaveNicEditorData( 'add-element-notes-field' );var sPayload = 'action=addelement&' + $(".add-element-form").serialize();var selectedType = $("[name=elementtype]").val();var selectedTechnology = $("[name=diagramtech]").val();var selectedDiagramType = $("[name=diagramtype]").val();var settings ={'type':selectedType,'technology':selectedTechnology,'diagram_type':selectedDiagramType};settingsJSON = JSON.stringify(settings);$.get('./data_api/set_setting.php?varname=add_object_selection&varval=' + settingsJSON,function (data){});var requestSettings ={type:'POST',url:'addelementengine.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (sResults != ''){if (sResults.substr(0,8) === 'success:'){WebeaSuccessMessage(sResults.substr(9));g_bAfterRefresh = true;var sGUID = GetLastGUID();LoadMainContents(sGUID,false);if (bCloseDialog){CloseDialog();}else{ClearInputField( document.getElementById('add-element-name-field') );ClearInputField( document.getElementById('add-element-notes-field') );ClearNicEditor( 'add-element-notes-field' );$("#add-element-name-field").focus();}}else{if (CheckFatalError(sResults) ){WebeaErrorMessage(sResults);}}LoadServerSystemoutput();}},complete:function(){$("#main-busy-loader1").hide();},error:function(jqXHR){}};$.ajax(requestSettings);}function StrTrim(str){str = String(str);if ( str != ''){str = str.replace(/^\s+|\s+$/gm,'');}return str;}function OnFormRunAddElementTest(event,bCloseDialog){bCloseDialog = bCloseDialog || false;event.preventDefault();SaveNicEditorData( 'add-elementtest-notes-field' );SaveNicEditorData( 'add-elementtest-input-field' );SaveNicEditorData( 'add-elementtest-acceptance-field' );SaveNicEditorData( 'add-elementtest-results-field' );var sPayload = 'action=addelementtest&' + $(".add-elementtest-form").serialize();var requestSettings ={type:'POST',url:'addelementtestengine.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (sResults != ''){if (sResults.substr(0,8) == 'success:'){ClearInputField( document.getElementById('add-elementtest-name-field') );ClearInputField( document.getElementById('add-elementtest-notes-field') );ClearInputField( document.getElementById('add-elementtest-input-field') );ClearInputField( document.getElementById('add-elementtest-acceptance-field') );ClearInputField( document.getElementById('add-elementtest-results-field') );ClearNicEditor( 'add-elementtest-notes-field' );ClearNicEditor( 'add-elementtest-input-field' );ClearNicEditor( 'add-elementtest-acceptance-field' );ClearNicEditor( 'add-elementtest-results-field' );WebeaSuccessMessage(sResults.substr(9));g_bAfterRefresh = true;var sGUID = GetLastGUID();LoadMainContents(sGUID,false);if (bCloseDialog){CloseDialog();}unsaved = false;$("#add-elementtest-name-field").focus();}else{if (CheckFatalError(sResults) ){WebeaErrorMessage(sResults);}}LoadServerSystemoutput();}},complete:function(){$("#main-busy-loader1").hide();},error:function(jqXHR){}};$.ajax(requestSettings);}function OnFormRunAddElementResAlloc(event,bCloseDialog){bCloseDialog = bCloseDialog || false;event.preventDefault();SaveNicEditorData( 'add-elementresalloc-notes-field' );var sPayload = 'action=addelementresalloc&' + $(".add-elementresalloc-form").serialize();var requestSettings ={type:'POST',url:'addelementresallocengine.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (sResults != ''){if (sResults.substr(0,8) == 'success:'){WebeaSuccessMessage(sResults.substr(9));ClearInputField( document.getElementById('add-elementresalloc-resource-field') );ClearInputField( document.getElementById('add-elementresalloc-startdate-field') );ClearInputField( document.getElementById('add-elementresalloc-enddate-field') );ClearInputField( document.getElementById('add-elementresalloc-percentcomp-field'),'0' );ClearInputField( document.getElementById('add-elementresalloc-expectedtime-field'),'0' );ClearInputField( document.getElementById('add-elementresalloc-allocatedtime-field'),'0' );ClearInputField( document.getElementById('add-elementresalloc-expendedtime-field'),'0' );ClearInputField( document.getElementById('add-elementresalloc-notes-field') );ClearInputField( document.getElementById('add-elementresalloc-history-field') );ClearNicEditor( 'add-elementresalloc-notes-field' );ClearNicEditor( 'add-elementresalloc-history-field' );g_bAfterRefresh = true;var sGUID = GetLastGUID();LoadMainContents(sGUID,false);if (bCloseDialog){CloseDialog();}$("#add-elementresalloc-resource-field").focus();}else{if (CheckFatalError(sResults) ){WebeaErrorMessage(sResults);}}LoadServerSystemoutput();}},complete:function(){$("#main-busy-loader1").hide();},error:function(jqXHR){}};$.ajax(requestSettings);}function OnFormRunAddElementChgMgmt(event,bCloseDialog){bCloseDialog = bCloseDialog || false;event.preventDefault();SaveNicEditorData( 'add-elementchgmgmt-notes-field' );SaveNicEditorData( 'add-elementchgmgmt-history-field' );var sPayload = 'action=addelementchgmgmt&' + $(".add-elementchgmgmt-form").serialize();var requestSettings ={type:'POST',url:'addelementchgmgmtengine.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (sResults != ''){if (sResults.substr(0,8) == 'success:'){WebeaSuccessMessage(sResults.substr(9));var dtToday = new Date();var sYYYY = dtToday.getFullYear().toString();var sMM = (dtToday.getMonth()+1).toString();var sDD = dtToday.getDate().toString();var sToday = sYYYY + '-' + (sMM[1]?sMM:"0"+sMM[0]) + '-' + (sDD[1]?sDD:"0"+sDD[0]);ClearInputField( document.getElementById('add-elementchgmgmt-name-field') );ClearInputField( document.getElementById('add-elementchgmgmt-status-field') );ClearInputField( document.getElementById('add-elementchgmgmt-priority-field') );ClearInputField( document.getElementById('add-elementchgmgmt-author1-field') );ClearInputField( document.getElementById('add-elementchgmgmt-date1-field'),sToday );ClearInputField( document.getElementById('add-elementchgmgmt-author2-field'),'' );ClearInputField( document.getElementById('add-elementchgmgmt-date2-field'),'' );ClearInputField( document.getElementById('add-elementchgmgmt-type-field'),'' );ClearInputField( document.getElementById('add-elementchgmgmt-version-field'),'1.0' );ClearInputField( document.getElementById('add-elementchgmgmt-weight-field'),'0' );ClearInputField( document.getElementById('add-elementchgmgmt-notes-field') );ClearInputField( document.getElementById('add-elementchgmgmt-history-field') );ClearNicEditor( 'add-elementchgmgmt-notes-field' );ClearNicEditor( 'add-elementchgmgmt-history-field' );g_bAfterRefresh = true;var sGUID = GetLastGUID();LoadMainContents(sGUID,false);if (bCloseDialog){CloseDialog();}$("#add-elementchgmgmt-name-field").focus();}else{if (CheckFatalError(sResults) ){WebeaErrorMessage(sResults);}}LoadServerSystemoutput();}},complete:function(){$("#main-busy-loader1").hide();},error:function(jqXHR){}};$.ajax(requestSettings);}function GetLastGUID(){var sGUID = '';if (typeof(window.history ) !== 'undefined'){if (window.history.state !== null && typeof(window.history.state ) !== 'undefined'){var sGUID = window.history.state.guid;}else{var sGUID = g_sLastGUID;}}return sGUID;}function OnFormRunEditElementNote(event){event.preventDefault();SaveNicEditorData( 'edit-elementnote-notes-field' );var sPayload = 'action=editelementnote&' + $(".edit-elementnote-form").serialize();var requestSettings ={type:'POST',url:'editelementnoteengine.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (sResults != ''){if (sResults.substr(0,8) == 'success:'){WebeaSuccessMessage(sResults.substr(9));CloseDialog();sGUID = $('input[name=parentguid]').val();RefreshNotes(sGUID);}else{if (CheckFatalError(sResults) ){WebeaErrorMessage(sResults);}}LoadServerSystemoutput();}},complete:function(){},error:function(jqXHR){$("#main-busy-loader1").hide();}};$.ajax(requestSettings);}function OnFormRunEditElementTest(event){event.preventDefault();SaveNicEditorData( 'edit-elementtest-notes-field' );SaveNicEditorData( 'edit-elementtest-input-field' );SaveNicEditorData( 'edit-elementtest-acceptance-field' );SaveNicEditorData( 'edit-elementtest-results-field' );var sPayload = 'action=editelementtest&' + $(".edit-elementtest-form").serialize();var requestSettings ={type:'POST',url:'editelementtestengine.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (sResults != ''){if (sResults.substr(0,8) == 'success:'){WebeaSuccessMessage(sResults.substr(9));sGUID = $('input[name=key1]').val();sTestID = $('input[name=testid]').val();CloseDialog();RefreshTest(sGUID,sTestID);}else{if (CheckFatalError(sResults) ){WebeaErrorMessage(sResults);}}LoadServerSystemoutput();}},complete:function(){},error:function(jqXHR){$("#main-busy-loader1").hide();}};$.ajax(requestSettings);}function OnFormRunEditElementResAlloc(event){event.preventDefault();SaveNicEditorData( 'edit-elementresalloc-notes-field' );SaveNicEditorData( 'edit-elementresalloc-history-field' );var sPayload = 'action=editelementresalloc&' + $(".edit-elementresalloc-form").serialize();var requestSettings ={type:'POST',url:'editelementresallocengine.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (sResults != ''){if (sResults.substr(0,8) == 'success:'){WebeaSuccessMessage(sResults.substr(9));sGUID = $('input[name=key1]').val();sResourceID = $('input[name=resourceid]').val();CloseDialog();RefreshResource(sGUID,sResourceID);}else{if (CheckFatalError(sResults) ){WebeaErrorMessage(sResults);}}LoadServerSystemoutput();}},complete:function(){},error:function(jqXHR){$("#main-busy-loader1").hide();}};$.ajax(requestSettings);}function OnFormRunWatchListConfig(event){event.preventDefault();var sPayload = 'action=watchlistconfig&' + $(".watchlist-config-form").serialize();var requestSettings ={type:'POST',url:'savewatchlistengine.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (sResults != ''){if (sResults.substr(0,8) == 'success:'){WebeaSuccessMessage(sResults.substr(9));MoveToPrevItemInNavigationHistory();}else{WebeaErrorMessage(sResults);}LoadServerSystemoutput();}},complete:function(){$("#main-busy-loader1").hide();},error:function(jqXHR){}};$.ajax(requestSettings);}function OnIntegerFieldLostFocus(sFieldID){var ele = document.getElementById(sFieldID);if (ele != null){var sValue = ele.value;sValue = sValue.replace(/[^0-9]/g,'');if ( sValue != ''){if (sValue != ele.value){ele.value = sValue;}}}}function OnDateFieldLostFocus(sFieldID){var ele = document.getElementById(sFieldID);if (ele != null){var sValue = StrTrim(ele.value);if ( sValue != ''){var dtNow = new Date();if (sValue.length=1 && sValue.length<=2){sValue = (dtNow.getMonth()+1).toString() + '-' + sValue;}if (sValue.length>=3 && sValue.length<=5){sValue = dtNow.getFullYear().toString() + '-' + sValue;}sValue = sValue.replace(/[\/. ]/g,'-');if (sValue.length==8 && sValue.substring(2,3)=='-' && sValue.slice(5,6)=='-'){sValue = dtNow.getFullYear().toString().substr(0,2) + sValue;}aDateParts = sValue.split('-');if (aDateParts.length == 3){if (CheckDate(aDateParts[0],aDateParts[1],aDateParts[2])){var dt = new Date(aDateParts[0],aDateParts[1],aDateParts[2],0,0,0,0);sValue = dt.getFullYear() + '-' + ('0' + dt.getMonth()).slice(-2) + '-' + ('0' + dt.getDate()).slice(-2);}}if (sValue != ele.value){ele.value = sValue;}}}}function CheckDate(year,month,day){var d = new Date(year,month,day);return d.getFullYear() == year &&d.getMonth() == month &&d.getDate() == day;}function ClearInputField(e,sNewValue){if ( !e ){return;}sNewValue = initialise_parameter_str(sNewValue,'');if (e.tagName){switch (e.tagName.toLowerCase()){case 'input':switch (e.type){case "radio":case "checkbox":e.checked = false;break;case "button":case "submit":case "image":break;default:e.value = sNewValue;break;}break;case 'select':e.selectedIndex = 0;break;case 'textarea':e.innerHTML = sNewValue;e.value = sNewValue;break;}}}function ClearNicEditor( sElementName ){if ( sElementName === '' ){return;}var e = nicEditors.findEditor(sElementName);if (e){e.setContent('<br />');}}function SaveNicEditorData( sElementName ){if ( sElementName === '' ){return;}var e = nicEditors.findEditor(sElementName);if (e){e.saveContent();}}function OnLinkDocPWDKeyDown(element,guid,name,image){if (element.keyCode == 13){LoadObject(guid,'false','encryptdoc','',name,image);return false;}return true;}function LoadObject(sGUID,sHasChild,sLinkType,sHyper,sInName,sInImageURL,bAdd2History){var bAdd2History = initialise_parameter_str(bAdd2History,true);var bLoadNavbar = true;var sGUID = initialise_parameter_str(sGUID,'');var sHasChild = initialise_parameter_str(sHasChild,'');var sLinkType = initialise_parameter_str(sLinkType,'');var sHyper = initialise_parameter_str(sHyper,'');var sInName = initialise_parameter_str(sInName,'');var sInImageURL = initialise_parameter_str(sInImageURL,'');var sPassword = '';var sPayload = '';var bExternalURL = false;CheckBrowserVisibility();if (sHasChild === ''){sHasChild = 'false';}ShowBusyLoaders(sGUID,sHasChild,sLinkType,sHyper);var sResType = GetResTypeFromGUID(sGUID);if (sLinkType == 'props' && sHyper == ''){sResType = 'Element';}if (sLinkType === 'encryptdoc'){var ele = $("input[id='linked-document-pwd-field']");if (typeof ele !== 'undefined'){sPassword = ele.val();}if (sHyper===''){sHyper = sPassword;}}var noSearchResults = false;var sText = '';var sImageURL = '';if (sInName=='' && sInImageURL=='' && sGUID!='' && sGUID != 'search' && sGUID != 'searchresults'){LoadDiagramObject(sGUID,false);return;}else{sText = sInName;sImageURL = sInImageURL;}if (sHyper === 'browser' && sHasChild === 'false'){$('.browser-item-name-td').removeClass('selected');$('.browser-item-name-td[guid="'+sGUID+'"]').addClass('selected');}$.ajax({type:"POST",cache:false,url:"mainview.php",data:{objectguid:sGUID,haschild:sHasChild,linktype:sLinkType,objectname:sText,hyper:sHyper,imageurl:sImageURL},beforeSend:function(){},success:function (response){if (sGUID==='searchresults'){if($(response).hasClass("no-results") && $("#search-message").is(":visible")){var term = $("[name=term]").val();$("#search-message").html('Search for \'' + term + '\' found no results');noSearchResults = true;bAdd2History = false;FocusSearchTerm();}else{$("#main-content-center").html(response);CloseDialog();}}else if(sHyper === 'artifact'){var videoButton = $(response).find(".stored-document-watch-video-button");if(videoButton.length !== 0){bAdd2History = false;bLoadNavbar = false;ShowVideoDialog(videoButton);}else if($(response).find(".stored-document-view-image-button").length !== 0){bAdd2History = false;bLoadNavbar = false;$("#image-viewer-dialog").remove();var imageViewer = $(response).find("#image-viewer-dialog");$("#webea-main-content").append(imageViewer);ShowImageViewerDialog();}else{$("#main-content-center").html(response);}}else{if (sHyper === 'browser' && (sHasChild === 'false' && sResType !== 'Package' && sResType !== 'ModelRoot')){$('.main-view')[0].outerHTML = $(response).filter('.main-view')[0].outerHTML;$('#main-mini-properties-view').html($(response).filter('#main-mini-properties-view').html());if($(".main-view").hasClass("show-browserminiprops"))$('#main-mini-properties-view').show();sHyper = '';HighlightElementOnClick();}else{$("#main-content-center").html(response);}}if ((sGUID==='collaborate') && (sLinkType === 'chat')){ChatRefreshNotification();}LoadServerSystemoutput();if (CheckFatalError('') ){if ( sGUID==='search' ){FocusSearchTerm();}if ( bAdd2History ){NavigationHistoryAdd(sGUID,sHasChild,sLinkType,sHyper,sText,sImageURL);}else{document.title = GetPageTitle(sGUID,sText,sLinkType,sHyper);}}if(sResType !== 'Element'){sessionStorage.setItem("current_props_tab","notes");}if($("#main-content-center").is(":visible")){$("#main-content-center")[0].scrollTop = 0;$("#main-content-center")[0].scrollLeft = 0;}},error:function(jqXHR){if ( sGUID==='searchresults' ){FocusSearchTerm();if (jqXHR.status >= 400 && jqXHR.status < 500){var ele = document.getElementById('search-message');if ( ele ){ele.innerHTML = jqXHR.responseText;ele.setAttribute('class','search-message-error');}else{WebeaAlert(get_translate-string('error_while_searching') + '\n\t' + jqXHR.responseText);}}HideBusyLoaders();}},complete:function(){if ( sGUID === 'searchresults' && !noSearchResults){LoadNavbar(sGUID,sHasChild,sLinkType,sHyper,sText,sImageURL);}else if (sGUID === 'watchlistresults' ){LoadNavbar(sGUID,sHasChild,sLinkType,sHyper,sText,sImageURL);}else if ((sHyper === 'artifact') && (bLoadNavbar)){LoadNavbar(sGUID,sHasChild,sLinkType,sHyper,sText,sImageURL);}HideBusyLoaders();}});if ( sGUID !== 'searchresults' && sGUID !== 'watchlistresults' && sHyper !== 'artifact'){LoadNavbar(sGUID,sHasChild,sLinkType,sHyper,sText,sImageURL);}RefreshStatusBarIcons(sGUID);}function LoadMainContents(sGUID,bAdd2History){var sGUID = initialise_parameter_str(sGUID,'');var bShowBusyLoader = false;var sResType = GetResTypeFromGUID(sGUID);if (sGUID === 'root'){sGUID = '';}$.ajax({type:"POST",cache:false,url:"mainview.php",data:{objectguid:sGUID},beforeSend:function(){if (bShowBusyLoader){$("#main-busy-loader1").show();}},success:function (response){$("#main-content-center").html(response);LoadServerSystemoutput();if (sResType !== 'Element'){sessionStorage.setItem("current_props_tab","notes");}},error:function(jqXHR){},complete:function(){}});}function ShowPropertiesViewBusyLoader(){if($('#main-mini-properties-view').is(':visible'))$("#miniprops-busy-loader").show();}function ShowBusyLoaders(sGUID,sHasChild,sLinkType,sHyper){if (sGUID === 'collaborate'){$(".chat-messages-container-overlay").show();}else if (sHyper === 'browser' && sHasChild === 'false'){if($('#main-mini-properties-view').is(':visible'))$("#miniprops-busy-loader").show();$("#mainview-busy-loader").show();}else{$("#main-busy-loader1").show();}}function HideBusyLoaders(){$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();$("#mainview-busy-loader").hide();}function GetPageTitle(sGUID,sName,sLinkType,sHyper){var sPageNamePrefix = 'WebEA - ';var sPageName = sPageNamePrefix + 'Model Root';if ( sLinkType!=='' ){if ( sLinkType==='document' ){sPageName = sPageNamePrefix + 'Linked doc for ' + sName;return sPageName;}else if ( sLinkType==='encryptdoc' ){sPageName = sPageNamePrefix + 'Encrypted doc ' + sName;return sPageName;}else if ( sLinkType==='favorites' ){sPageName = sPageNamePrefix + 'Favorites';return sPageName;}}if ( sGUID === 'addmodelroot' ){$sResType = sPageNamePrefix + 'Add Root Node ' + sName;}else if ( sGUID === 'addviewpackage' ){$sResType = sPageNamePrefix + 'Add View ' + sName;}else if ( sGUID==='addelement' ){return sPageNamePrefix + 'Add element to ' + sName;}else if ( sGUID==='addelementtest' ){return sPageNamePrefix + 'Add test to ' + sName;}else if ( sGUID==='addelementresalloc' ){return sPageNamePrefix + 'Add resource allocation to ' + sName;}else if ( sGUID==='addelementchgmgmt' ){var a = sLinkType.split("|");var sChgmgtType = a[1];if ( sChgmgtType==='feature' ){return sPageNamePrefix + 'Add feature to ' + sName;}else if ( sChgmgtType==='change' ){return sPageNamePrefix + 'Add change to ' + sName;}else if ( sChgmgtType==='document' ){return sPageNamePrefix + 'Add document to ' + sName;}else if ( sChgmgtType==='defect' ){return sPageNamePrefix + 'Add defect to ' + sName;}else if ( sChgmgtType==='issue' ){return sPageNamePrefix + 'Add issue to ' + sName;}else if ( sChgmgtType==='task' ){return sPageNamePrefix + 'Add task to ' + sName;}else if ( sChgmgtType==='risk' ){return sPageNamePrefix + 'Add risk to ' + sName;}}else if ( sGUID==='editelementnote' ){return sPageNamePrefix + 'Edit note for ' + sName;}else if ( sGUID==='editelementtest' ){return sPageNamePrefix + 'Edit test for ' + sName;}else if ( sGUID==='editelementresalloc' ){return sPageNamePrefix + 'Edit resource allocation for ' + sName;}if ( sGUID==='initialize' ){sPageName = sPageNamePrefix + 'HOME';}else if ( sGUID!=='' ){sPageName = sPageNamePrefix + '[Unnamed object]';}if ( sName!=='' ){sPageName = sPageNamePrefix + sName;}return sPageName;}function LoadDiagramObject(sGUID,bReplaceLastState){var sHasChild = 'false';var sLinkType = '';var sHyper = '';var bPropsIsVisible = $("#main-mini-properties-view").is(":visible");var bIsDiagram = false;if(sGUID.substr(0,3) === 'dg_')bIsDiagram = true;if(bPropsIsVisible && !bIsDiagram){LoadMinipropsObject(sGUID);}else{$("#main-page-overlay").hide();$("#main-busy-loader1").show();var sResType = GetResTypeFromGUID(sGUID);var sURL = './data_api/get_json_element.php' + (( sGUID!='') ? '?objectguid=' + encodeURIComponent(sGUID):'');$.ajax({type:"POST",url:sURL,dataType:"text json",cache:true, success:function (a){if (a != null){var sObjGUID = '';var sObjName = '';var sObjType = '';var sObjResType = '';var sObjLinkType = '';var sObjHyper = '';var sObjHasChild = '';var sObjNType = '';var sObjImageURL = '';var sFirstDescGUID = '';var sFirstDescResType = '';var sErrorCode = '';var sErrorMsg = '';sObjGUID = a['guid'];sObjName = a['namealias'];sObjType = a['type'];sObjResType = a['restype'];sObjLinkType = a['linktype'];sObjHyper = a['hyper'];sObjHasChild = a['haschild'];sObjImageURL = a['imageurl'];sObjNType = a['ntype'];sFirstDescGUID = a['firstdescguid'];sCompositeGUID = a['compositeguid'];sErrorCode = a['errorcode'];sErrorMsg = a['errormsg'];if ( CheckFatalError( sErrorCode + ' - ' + sErrorMsg ) ){if (sObjLinkType!==''){if (sObjLinkType === 'Help'){sObjHyper = sObjHyper.toLowerCase();sObjHyper = gc_sHelpLocation + sObjHyper;}else if (sObjLinkType === 'Imageman'){var iPos = sObjHyper.indexOf("/im_{");if ( iPos > 0){sObjHyper = sObjHyper.substr(iPos);sObjHyper = sObjHyper.replace(/[\/]/g,'');}}LoadObjectFromHyper(sObjHyper,sObjLinkType);}else if ( sObjType === 'ModelRoot' ){sLinkType = '';sGUID = 'mr' + sGUID.substr(2);LoadObject(sGUID,sHasChild,sLinkType,sHyper,sObjName,sObjImageURL);}else if ( sObjResType === 'Package' || (sObjResType === 'Element' && sObjType === 'Package') ){var nav = $('#webea-navigate-to-diagram').text();if ( sFirstDescGUID !='' && nav == '1'){LoadObject(sFirstDescGUID,'false','','','','',false);}else{sLinkType = '';sGUID = 'pk' + sGUID.substr(2);LoadObject(sGUID,sHasChild,sLinkType,sHyper,sObjName,sObjImageURL);}}else if (sObjGUID === 'matrix'){if ( bReplaceLastState ){LoadObject(sObjGUID,sHasChild,sLinkType,sObjHyper,sObjName,sObjImageURL,!bReplaceLastState);ReplaceHistoryState(sObjGUID,sHasChild,sLinkType,sObjHyper,sObjName,sObjImageURL,'WebEA','index.php');}else{LoadObject(sObjGUID,sHasChild,sLinkType,sObjHyper,sObjName,sObjImageURL);}}else if (sObjNType === '8'){if($('.collab-header').is(':visible')){sCompositeGUID = '';}var nav = $('#webea-navigate-to-diagram').text();var currentGUID = $('input[name=current_guid]').val();if (nav == '1' &&sCompositeGUID !='' &&(sCompositeGUID !== ('dg_{' + currentGUID +'}'))){if (!g_bIsLoadGUID){LoadObject(sCompositeGUID,'false','','','','',false);}else{LoadObject(sGUID,sHasChild,sLinkType,sHyper,sObjName,sObjImageURL);}}else{if ( bReplaceLastState ){LoadObject(sGUID,sHasChild,sLinkType,sHyper,sObjName,sObjImageURL,!bReplaceLastState);ReplaceHistoryState(sGUID,sHasChild,sLinkType,sHyper,sObjName,sObjImageURL,'WebEA','index.php');}else{LoadObject(sGUID,sHasChild,sLinkType,sHyper,sObjName,sObjImageURL);}}}else{if(sObjType === 'Artifact'){sHyper = 'artifact';bReplaceLastState = false;}if ( bReplaceLastState ){LoadObject(sGUID,sHasChild,sLinkType,sHyper,sObjName,sObjImageURL,!bReplaceLastState);ReplaceHistoryState(sGUID,sHasChild,sLinkType,sHyper,sObjName,sObjImageURL,'WebEA','index.php');}else{LoadObject(sGUID,sHasChild,sLinkType,sHyper,sObjName,sObjImageURL);}}}}else{$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();}},error:function(jqXHR){if ( jqXHR.status === 200 ){var bShowStdMsg = true;var sMsg = jqXHR.responseText;var iPos = sMsg.indexOf("{");if ( iPos > 0 && sMsg.substr(sMsg.length-2,1)=='}'){var sJSONStr = sMsg.substr(iPos);if ( IsJsonString(sJSONStr) ){var o = JSON.parse(sJSONStr);var sErrMsg = o['errorcode'] + ' - ' + o['errormsg'];if ( CheckFatalError(sErrMsg) == false ){bShowStdMsg = false;}}}if ( bShowStdMsg ){}}else{}$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();}});}}function IsJsonString(str){try{JSON.parse(str);}catch (e){Write2Console('IsJSONString:e=' + e.message);return false;}return true;}function LoadObjectFromHyper(sHyper,sLinkType){sHyper = initialise_parameter_str(sHyper,'');sLinkType = initialise_parameter_str(sLinkType,'');if (sHyper.substr(0,7)=='http://' || sHyper.substr(0,8)=='https://'){window.open(sHyper,'_self');$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();}else if (sLinkType === 'Imageman'){var sURL = './data_api/dl_model_image.php' + (( sHyper!='') ? '?objectguid=' + encodeURIComponent(sHyper):'');var ele = document.getElementById('main_diagram_iframe');if ( ele ){ele.src = sURL;}$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();}else{var sName = '';var sImageURL = '';var sErrorCode = '';var sErrorMsg = '';var sResType = GetResTypeFromGUID(sHyper);var sHasChild = 'false';if ( sResType == 'Package' || sResType == 'ModelRoot' ){sHasChild = 'true';}var sURL = './data_api/get_json_element.php' + (( sHyper!='') ? '?objectguid=' + encodeURIComponent(sHyper):'');$.ajax({type:"POST",url:sURL,dataType:"text json",success:function (a){if (a != null){sName = a['namealias'];sImageURL = a['imageurl'];sErrorCode = a['errorcode'];sErrorMsg = a['errormsg'];}if ( CheckFatalError( sErrorCode + ' - ' + sErrorMsg ) ){LoadObject(sHyper,sHasChild,sLinkType,'',sName,sImageURL);}},error:function (jqXHR){if ( jqXHR.status === 200 ){var bShowStdMsg = true;var sMsg = jqXHR.responseText;var iPos = sMsg.indexOf("{");if ( iPos > 0 && sMsg.substr(sMsg.length-2,1)=='}'){var sJSONStr = sMsg.substr(iPos);if ( IsJsonString(sJSONStr) ){var o = JSON.parse(sJSONStr);var sErrMsg = o['errorcode'] + ' - ' + o['errormsg'];if ( CheckFatalError(sErrMsg) == false ){bShowStdMsg = false;}}}if ( bShowStdMsg ){WebeaAlert("LoadObjectFromHyper:" + '\t' + sMsg );}}else{WebeaAlert("LoadObjectFromHyper:\t" + jqXHR.responseText);}},complete:function(){$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();}});}}function RefreshCurrent(){g_bAfterRefresh = true;if (typeof(window.history ) !== 'undefined'){if (window.history.state !== null && typeof(window.history.state ) !== 'undefined'){var sGUID = window.history.state.guid;var sHasChild = window.history.state.haschild;var sLinkType = window.history.state.linktype;var sHyper = window.history.state.hyper;var sName = window.history.state.name;var sImageURL = window.history.state.imageurl;LoadObject(sGUID,sHasChild,sLinkType,sHyper,sName,sImageURL,false)}else{var sGUID = g_sLastGUID;var sHasChild = g_sLastHasChild;var sLinkType = g_sLastLinkType;var sHyper = g_sLastHyper;var sName = g_sLastName;var sImageURL = g_sLastImageURL;LoadObject(sGUID,sHasChild,sLinkType,sHyper,sName,sImageURL,false)}}}function RefreshDiagram(refreshType){if (typeof(window.history ) !== 'undefined'){if (window.history.state !== null && typeof(window.history.state ) !== 'undefined'){var sGUID = window.history.state.guid;var sHasChild = window.history.state.haschild;var sLinkType = window.history.state.linktype;var sHyper = window.history.state.hyper;var sInName = window.history.state.name;var sInImageURL = window.history.state.imageurl;}else{var sGUID = g_sLastGUID;var sHasChild = g_sLastHasChild;var sLinkType = g_sLastLinkType;var sHyper = g_sLastHyper;var sInName = g_sLastName;var sInImageURL = g_sLastImageURL;}}var sPayload = '';var bExternalURL = false;$("#main-busy-loader1").show();var sResType = GetResTypeFromGUID(sGUID);var sText = sInName;var sImageURL = sInImageURL;console.log(sImageURL);$.ajax({type:"POST",cache:false,url:"mainview.php",data:{objectguid:sGUID,haschild:sHasChild,linktype:sLinkType,objectname:sText,hyper:sHyper,imageurl:sImageURL},beforeSend:function(){$("#main-busy-loader1").show();},success:function (response){$("#main-content-center").html(response);},error:function(jqXHR){},complete:function(){$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();}});var ele = $('#main-navbar');if ( ele != null ){$.ajax({type:"POST",cache:false,url:"navbar.php",data:{guid:sGUID,haschild:sHasChild,linktype:sLinkType,hyper:sHyper,name:sInName,imageurl:sInImageURL},beforeSend:function(){$("#navbar-busy-loader").show();},success:function(sNavBarHTML){if(refreshType === 'zoom'){$('.diagram-zoom').html($(sNavBarHTML).find('.diagram-zoom').html());}else{document.getElementById('main-navbar').innerHTML = sNavBarHTML;}},error:function(jqXHR){Write2Console('LoadNavbar:' + jqXHR.statusText);},complete:function(){$("#navbar-busy-loader").hide();}});}}function LoadHome(bReplaceHistory){CheckBrowserVisibility();var bSomethingLoaded = false;try{bValid = false;var sDefaultDiagram = $("#model-default-diagram").text();if (sDefaultDiagram !== ''){if (sDefaultDiagram === 'favorites'){LoadFavorites();bSomethingLoaded = true;}else{if (sDefaultDiagram.substr(0,4) == 'dg_{' && sDefaultDiagram.length == 41){bValid = true;}else if (sDefaultDiagram.substr(0,1) == '{' && sDefaultDiagram.substr(-1) == '}' && sDefaultDiagram.length == 38){bValid = true;sDefaultDiagram = 'dg_' + sDefaultDiagram;}if ( bValid ){if ( bReplaceHistory ){ReplaceHistoryState('','','','','','','WebEA - Model Root','index.php');}LoadDiagramObject(sDefaultDiagram,false);bSomethingLoaded = true;}}}if ( !bSomethingLoaded ){if ( bReplaceHistory ){LoadObject('','false','','','','',false);ReplaceHistoryState('','','','','','','WebEA - Model Root','index.php');}else{LoadObject('','false','','','','');}bSomethingLoaded = true;}}catch (err){WebeaAlert(GetTranslateString('error_navigating_to_home') + ' ' + err.message);}return bSomethingLoaded;}function LoadFavorites(){LoadObject('','false','favorites','','','');}function LoadMinipropsObject(sGUID){ShowPropertiesViewBusyLoader();if ($("#main-mini-properties-view").css("display") === 'block'){var ele = $("#mini-properties-view-section");if ( ele.length ){var bLoadProps = false;var sMPNavigates = $('#webea-miniprops-navigates').text();if ( sMPNavigates == '1'){var sURL = './data_api/get_json_element.php' + (( sGUID!='') ? '?objectguid=' + encodeURIComponent(sGUID):'');$.ajax({type:"POST",url:sURL,dataType:"text json",success:function (a){if (a != null){var sObjGUID = '';var sObjName = '';var sObjType = '';var sObjResType = '';var sObjLinkType = '';var sObjHyper = '';var sObjHasChild = '';var sObjImageURL = '';var sObjNType = '';var sFirstDescGUID = '';var sCompositeGUID = '';var sErrorCode = '';var sErrorMsg = '';sObjGUID = a['guid'];sObjName = a['namealias'];sObjType = a['type'];sObjResType = a['restype'];sObjLinkType = a['linktype'];sObjHyper = a['hyper'];sObjHasChild = a['haschild'];sObjImageURL = a['imageurl'];sObjNType = a['ntype'];sFirstDescGUID = a['firstdescguid'];sCompositeGUID = a['compositeguid'];sErrorCode = a['errorcode'];sErrorMsg = a['errormsg'];if (typeof a['stereotypes'] !== 'undefined'){sStereotype = a['stereotypes'][0]['name'];}else{sStereotype = '';}if ( CheckFatalError( sErrorCode + ' - ' + sErrorMsg ) ){if (sObjLinkType!==''){if (sObjLinkType === 'Help'){sObjHyper = sObjHyper.toLowerCase();sObjHyper = gc_sHelpLocation + sObjHyper;}else if (sObjLinkType === 'Imageman'){var iPos = sObjHyper.indexOf("/im_{");if ( iPos > 0){sObjHyper = sObjHyper.substr(iPos);sObjHyper = sObjHyper.replace(/[\/]/g,'');}}LoadObjectFromHyper(sObjHyper,sObjLinkType);}else if ( sObjType === 'ModelRoot' ){sGUID = 'mr' + sGUID.substr(2);LoadMinipropsObjectInternal(sGUID);}else if ( sObjResType === 'Package' || (sObjResType === 'Element' && sObjType === 'Package') ){var nav = $('#webea-navigate-to-diagram').text();if ( sFirstDescGUID !='' && nav == '1'){LoadObject(sFirstDescGUID,'false','','','','',false);}else{sGUID = 'pk' + sGUID.substr(2);LoadMinipropsObjectInternal(sGUID);}}else if (sObjGUID === 'matrix'){LoadObject(sObjGUID,'false','',sObjHyper,sObjName,sObjImageURL);}else if (sObjNType === '8'){var nav = $('#webea-navigate-to-diagram').text();var currentGUID = $('input[name=current_guid]').val();if (nav == '1' &&sCompositeGUID !='' &&(sCompositeGUID !== ('dg_{' + currentGUID +'}'))){LoadObject(sCompositeGUID,'false','','','','',false);}else{LoadMinipropsObjectInternal(sGUID);}}else if ((sObjResType === 'Element' && sObjType === 'Activity') && (sStereotype === 'Decision' || sStereotype === 'BusinessKnowledgeModel')){LoadObject(sObjGUID,'false','props','',sObjName,sObjImageURL);}else{LoadMinipropsObjectInternal(sGUID);}}}else{}},error:function(jqXHR){if ( jqXHR.status === 200 ){var bShowStdMsg = true;var sMsg = jqXHR.responseText;var iPos = sMsg.indexOf("{");if ( iPos > 0 && sMsg.substr(sMsg.length-2,1)=='}'){var sJSONStr = sMsg.substr(iPos);if ( IsJsonString(sJSONStr) ){var o = JSON.parse(sJSONStr);var sErrMsg = o['errorcode'] + ' - ' + o['errormsg'];if ( CheckFatalError(sErrMsg) == false ){bShowStdMsg = false;}}}if ( bShowStdMsg ){}}else{}},complete:function(){}});}else{LoadMinipropsObjectInternal(sGUID);}}}else{sError = GetTranslateString('miniprops_is_disabled');$.get('./data_api/set_setting.php?varname=show_propertiesview&varval=' + 'false',function (data){});LoadDiagramObject(sGUID);}}function LoadMinipropsObjectInternal(sGUID){showingMainProps = false;showingContents = false;if ($('#properties-main').length){showingMainProps = true;}if (($('#main-package-list').length) ||($('#main-package-icon').length)){showingContents = true;}if ( sGUID !== '' ){$.ajax({type:"POST",cache:false,url:"miniproperties.php",data:{objectguid:sGUID,bShowingMainProps:showingMainProps,bShowingContents:showingContents},beforeSend:function(){$("#miniprops-busy-loader").show();},success:function(sHTML){document.getElementById('mini-properties-view-section').innerHTML = sHTML;LoadServerSystemoutput();var videoButton = $(sHTML).find(".stored-document-watch-video-button");if(videoButton.length !== 0){ShowVideoDialog(videoButton);}else if($(sHTML).find(".stored-document-view-image-button").length !== 0){ShowImageViewerDialog();}},error:function(jqXHR){Write2Console('LoadMinipropsObject:' + jqXHR.statusText);},complete:function(){$("#miniprops-busy-loader").hide();}});}}function GetResTypeFromGUID(sGUID){var sResType = '';sGUID = String(sGUID);if (sGUID.substr(0,4)=='mr_{'){sResType = 'ModelRoot';}else if (sGUID.substr(0,4)=='pk_{'){sResType = 'Package';}else if (sGUID.substr(0,4)=='dg_{' || sGUID.substr(0,4)=='di_{'){sResType = 'Diagram';}else if (sGUID.substr(0,4)=='el_{'){sResType = 'Element';}else if (sGUID === 'search'){sResType = 'Search';}else if (sGUID === 'searchresults'){sResType = 'Search Results';}else if (sGUID === 'watchlist'){sResType = 'Watchlist';}else if (sGUID === 'watchlistconfig'){sResType = 'Watchlist configuration';}else if (sGUID === 'watchlistresults'){sResType = 'Watchlist Results';}return sResType;}function NavigationHistoryAdd(sGUID,sHasChild,sLinkType,sHyper,sName,sImageURL){var sPrevGUID = '';var sPrevHasChild = '';var sPrevLinkType = '';if (sGUID===''){sGUID = 'root';sImageURL = 'images/navbar/root.png';}var a ={};a['guid'] = sGUID;a['haschild'] = sHasChild;a['linktype'] = sLinkType;a['hyper'] = sHyper;a['name'] = sName;a['imageurl'] = sImageURL;var sDisplayName = GetPageTitle(sGUID,sName,sLinkType,sHyper);document.title = sDisplayName;if (typeof history.pushState != 'undefined'){window.history.pushState(a,sDisplayName,'index.php');}g_sLastGUID = sGUID;g_sLastHasChild = sHasChild;g_sLastLinkType = sLinkType;g_sLastHyper = sHyper;g_sLastName = sName;g_sLastImageURL = sImageURL;}function OnIndexPopState(event){if (event.state !== null){var sGUID = event.state.guid;var sHasChild = event.state.haschild;var sLinkType = event.state.linktype;var sHyper = event.state.hyper;var sName = event.state.name;var sImageURL = event.state.imageurl;LoadObject(sGUID,sHasChild,sLinkType,sHyper,sName,sImageURL,false)}else{Write2Console('onIndexPopState:Count=' + window.history.length + ' something wrong with event.state');}}function MoveToPrevItemInNavigationHistory(){if (typeof(window.history.state ) !== 'undefined' && window.history.state !== null){window.history.back();}else{if (g_sLastGUID==='editelementnote' ||g_sLastGUID==='editelementtest' ||g_sLastGUID==='editelementresalloc' ){var a = g_sLastLinkType.split("|");var sGUID = '';if (a.length > 0){sGUID = a[0];}if ( sGUID!=='' ){LoadObject(sGUID,'','','',g_sLastName,g_sLastImageURL,false);}}else if (g_sLastGUID==='watchlistconfig' || g_sLastGUID==='watchlistresults' ){LoadObject('watchlist','','','','Watchlist','images/element16/watchlist.png',false);}else if (g_sLastGUID==='watchlist' ){LoadHome(false);}else{Write2Console('MoveToPrevItemInNavigationHistory:LastGUID=' + g_sLastGUID);window.history.back();}}}function GoBack(){window.history.back();}function GetCurrentHistoryState(){a ={};if (typeof(window.history.state ) !== 'undefined' && window.history.state !== null){if (typeof(window.history.state.guid ) !== 'undefined'){a['guid'] = window.history.state.guid;a['haschild'] = window.history.state.haschild;a['linktype'] = window.history.state.linktype;a['hyper'] = window.history.state.hyper;a['name'] = window.history.state.name;a['imageurl'] = window.history.state.imageurl;}else{Write2Console('GetCurrentHistoryState:state.guid is undefined');}}return JSON.stringify(a);}function ReplaceHistoryState(sGUID,sHasChild,sLinkType,sHyper,sName,sImageURL,sTitle,sPage){if (typeof history.replaceState != 'undefined'){window.history.replaceState({guid:sGUID,haschild:sHasChild,linktype:sLinkType,hyper:sHyper,name:sName,imageurl:sImageURL},sTitle,sPage);}}function OnStoreLastPage(event){if ( !g_bIsLoggingOff ){var sCurrPage = GetCurrentHistoryState();if ( sCurrPage != '' ){var sLastPageTimeout = $("#model-lastpage-timeout").text();var iLastPageTimeout = Number(sLastPageTimeout);var date = new Date();date.setTime(date.getTime() + (iLastPageTimeout * 60000));var sExpires = ";expires=" + date.toUTCString();var sPageModelNo = $("#page-built-with-model-no").text();document.cookie = 'webea_lastpage_' + sPageModelNo + '=' + sCurrPage + sExpires + ';path=/;';}}}function GetCookieValue(sName){var b = document.cookie.match('(^|;)\\s*' + sName + '\\s*=\\s*([^;]+)');return b ? b.pop():'';}function CheckCookiesEnabled(){if (!navigator.cookieEnabled){$("#webea-nocookies-popup").show();$("#webea-main-content").hide();}}function Write2Console(sMessage){if (g_bJSDebugging){if (typeof(window.console) !== 'undefined'){if (window.console){window.console.log(sMessage);}}}}function SetMainLayout(sMainLayout){if (sMainLayout!=='1' && sMainLayout!=='2' && sMainLayout!=='3'){sMainLayout = '1';}$.get('./data_api/set_setting.php?varname=mainlayout&varval=' + sMainLayout,function (data){var sViewingMode = $('#webea-viewing-mode').text();if ( sViewingMode=='1'){RefreshCurrent();}});}function OnFormRunAddDiscussion(event,ele){event.preventDefault();var sComments = $(ele).parent().next().children().first().val();if (sComments !== ''){var form = $(ele).parent().parent().parent();var sGUID = form[0].elements["guid"].value;var sPayload = form.serializeAndEncode();$.ajax({type:"POST",url:"./data_api/add_discussion.php",data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(sErrorMsg){sErrorMsg = StrTrim(sErrorMsg);if ( sErrorMsg == '' ){RefreshDiscussionSection(sGUID,'');}else{if ( CheckFatalError(sErrorMsg) ){WebeaAlert('Error:' + sErrorMsg);}}},error:function(jqXHR){$("#main-busy-loader1").hide();WebeaAlert("OnFormRunAddDiscussion:" + jqXHR.responseText);},complete:function(){$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();}});}}function RefreshDiscussionSection(sElementGUID,sDiscussGUID2Expand){usealtcolour = 0;if ($(".section-heading-open").hasClass("section-heading-miniprops-open")){usealtcolour = 1;}sPayload = 'objectguid=' + encodeURIComponent(sElementGUID) + '&usealtcolour=' + usealtcolour;$.ajax({type:"POST",cache:false,url:"./refreshdiscussions.php",data:sPayload,success:function(response){var sErrorMsg = StrTrim(response);if ( sErrorMsg.substr(0,6) == 'error:' ){sErrorMsg = sErrorMsg.substr(7);}else{sErrorMsg = '';}if ( CheckFatalError(sErrorMsg) ){if( $(".discussion-content").is(":visible") ){$('.discussion-content').html($(response).find('.discussion-content').html());}if( $(".review-content").is(":visible") ){$('.review-content').html($(response).find('.review-content').html());}LoadServerSystemoutput();var ele = document.getElementsByClassName('replies_' + sDiscussGUID2Expand);for (var i = 0;i < ele.length;i++){if (ele[i]){par = ele[i].parentNode;if ((ele[i].style.display === 'none' || ele[i].style.display === '')){ele[i].style.display = 'block';par.className = 'discussion-item collapsible-section-header-opened';$(ele[i]).parent().children().first().removeClass("collapsible-section-header-closed-icon").addClass("collapsible-section-header-opened-icon");}}}}DiscussionKeyPressEvents();},error:function(jqXHR){WebeaAlert("RefreshDiscussionSection:" + jqXHR.responseText);}});}function DiscussionKeyPressEvents(){$(".discussion-new-comment").keypress(function(e){if((e.keyCode) == 13 && e.shiftKey){}else if ((e.keyCode) == 13){e.preventDefault();$(this).parent().next().find("#discussion-send-button").click();}});$(".discussion-reply-new-comment").keypress(function(e){if((e.keyCode) == 13 && e.shiftKey){}else if ((e.keyCode) == 13){e.preventDefault();$(this).parent().next().find(".discussion-reply-send-button").click();}});}function OnFormRunAddReply(e,oForm){e.preventDefault();var sPayload = $(oForm).serializeAndEncode();var sComments = oForm.comments.value;if (sComments !== ''){var sIsReply = 'true';var sObjectGUID = oForm.objectguid.value;var sGUID = oForm.guid.value;$.ajax({type:"POST",url:"./data_api/add_discussion.php",data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(sErrorMsg){sErrorMsg = StrTrim(sErrorMsg);if ( sErrorMsg=='' ){RefreshDiscussionSection(sObjectGUID,sGUID);}else{if ( CheckFatalError(sErrorMsg) ){WebeaAlert('Error:' + sErrorMsg);}}},error:function(jqXHR){$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();WebeaAlert("OnFormRunAddReply:" + jqXHR.responseText);},complete:function(){$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();}});}}function OnToggleDiscussionReplies(ele){var ele = $(ele).next().next().get(0);if (ele != null){var par = ele.parentNode;var eleImg = null;if (par!= null){eleImg = par.getElementsByTagName("img");}var previousDisplay = ele.style.display;var parentSection = $(ele).parent().parent();$(function(){parentSection.children(".discussion-item").children(".discussion-item-replies").hide();parentSection.children(".collapsible-section-header-opened").removeClass('collapsible-section-header-opened').addClass('collapsible-section-header-closed');parentSection.children(".discussion-item").children(".discussion-item-icon.collapsible-section-header-opened-icon").removeClass('collapsible-section-header-opened-icon').addClass('collapsible-section-header-closed-icon');});if ((previousDisplay === 'none' || previousDisplay === '')){ele.style.display = 'block';par.className = 'discussion-item collapsible-section-header-opened';if (eleImg!= null){eleImg[0].className = 'discussion-item-icon collapsible-section-header-opened-icon show-cursor-pointer'}}}}function OnTogglePropertiesReviewDiscussionReplies(ele){var ele = $(ele).next().next().get(0);if (ele != null){par = ele.parentNode;var eleImg = null;if (par!= null){eleImg = par.getElementsByTagName("img");}var previousDisplay = ele.style.display;var parentSection = $(ele).parent().parent();$(function(){parentSection.children(".review-item").children(".review-item-replies").hide();parentSection.children(".review-item").children(".collapsible-section-header-opened").removeClass('review-item collapsible-section-header-opened').addClass('review-item collapsible-section-header-closed');parentSection.children(".review-item").children(".review-item-icon.collapsible-section-header-opened-icon").removeClass('collapsible-section-header-opened-icon').addClass('collapsible-section-header-closed-icon');});if ((previousDisplay === 'none' || previousDisplay === '')){ele.style.display = 'block';par.className = 'review-item collapsible-section-header-opened';if (eleImg!= null){eleImg[0].className = 'review-item-icon collapsible-section-header-opened-icon show-cursor-pointer'}}}}function OnToggleReviewDiscussionReplies(sGUID){var ele = document.getElementById('mpreplies_' + sGUID);if (ele != null){par = ele.parentNode;var eleImg = null;if (par!= null){eleImg = par.getElementsByTagName("img");}var previousDisplay = ele.style.display;if ((previousDisplay === 'none' || previousDisplay === '')){ele.style.display = 'block';par.className = 'reviewdiscussion-discussion-item collapsible-section-header-opened';if (eleImg!= null){eleImg[0].className = 'reviewdiscussion-discussion-item-icon collapsible-section-header-opened-icon show-cursor-pointer'}}else{ele.style.display = 'none';par.className = 'reviewdiscussion-discussion-item collapsible-section-header-closed';if (eleImg!= null){eleImg[0].className = 'reviewdiscussion-discussion-item-icon collapsible-section-header-closed-icon show-cursor-pointer'}}}}function OnToggleCollapsibleSection(ele){if (ele != null){eleImg = $(ele).children().first();if (ele.className.indexOf("collapsible-section-header-closed") == -1){ele.className = ele.className.replace("collapsible-section-header-opened","collapsible-section-header-closed");if (eleImg!= null){eleImg[0].className = 'collapsible-section-header-closed-icon'}var ele2 = ele.nextElementSibling;if (ele2 != null){ele2.className = ele2.className.replace("w3-show","w3-hide");}}else{ele.className = ele.className.replace("collapsible-section-header-closed","collapsible-section-header-opened");if (eleImg!= null){eleImg[0].className = 'collapsible-section-header-opened-icon'}var ele2 = ele.nextElementSibling;if (ele2 != null){ele2.className = ele2.className.replace("w3-hide","w3-show");}}}}function OnTogglePlusMinusState(eleParent,sChildElementID){var ele = document.getElementById(sChildElementID);if (ele.style.display === 'none' || ele.style.display === ''){ele.style.display = 'block';if ( eleParent ){eleParent.className = eleParent.className.replace("collapsible-plusminussection-closed","collapsible-plusminussection-opened");}}else{ele.style.display = 'none';if ( eleParent ){eleParent.className = eleParent.className.replace("collapsible-plusminussection-opened","collapsible-plusminussection-closed");}}}function EnsureInputFieldVisible(element){if (element!=null){setTimeout(function(){element.scrollIntoView();},500);}}function OnShowAboutPage(sWebEAVersion){$("#navbar-hamburger-menu").hide();var sMessage = '';var sURL = './data_api/get_json_serverdetails.php';$.ajax({type:"POST",url:sURL,dataType:"text json",beforeSend:function(){$("#main-busy-loader1").show();},success:function (a){if (a != null){var sDBMan = '';var sAuthor = '';var sAuthorWeb = '';var sPCSVersion = '';var sVersion = '';var sLicense = '';var sProtocol = '';var sServer = '';var sPort = '';var sDBAlias = '';var sReadOnly = '';var sSecurityEnabled = '';var sLoginUser = '';var sLoginFullName = '';var sFormattedUser = '';sDBMan = a['databasemanager'];sAuthor = a['appauthor'];sAuthorWeb = a['appauthorwebsite'];sPCSVersion = a['pcsversion'];sVersion = a['version'];sLicense = a['license'];sLicenseExpiry = a['licenseexpiry'];sProtocol = a['protocol'];sServer = a['server'];sPort = a['port'];sDBAlias = a['dbalias'];sReadOnly = a['readonly'];sSecurityEnabled= a['securityenabled'];sLoginUser = a['loginuser'];sLoginFullName = a['loginfullname'];sReviewSession = a['reviewsession'];sReviewSessionName = a['reviewsessionname'];if ( sLoginUser!=='' && sLoginFullName!=='' ){sFormattedUser = sLoginFullName + ' (' + sLoginUser + ')';}else if ( sLoginUser!=='' ){sFormattedUser = sLoginUser;}else if ( sLoginFullName!=='' ){sFormattedUser += sLoginFullName;}var sFullServer = '';sFullServer = (sProtocol ? sProtocol:'localhost') + '://';sFullServer = sFullServer + (sServer ? sServer:'localhost');sFullServer = sFullServer + ':' + (sPort ? sPort:'80');SetupWebEAPropDivElement('author',sAuthor);SetupWebEAPropDivElement('pcsversion',sPCSVersion);SetupWebEAPropDivElement('sscsversion',sVersion);SetupWebEAPropDivElement('sscslicense',sLicense);SetupWebEAPropDivElement('sscslicenseexpiry',sLicenseExpiry);SetupWebEAPropDivElement('server',sFullServer);SetupWebEAPropDivElement('readonly',sReadOnly);SetupWebEAPropDivElement('appversion','WebEA v' + sWebEAVersion);SetupWebEAPropDivElement('security',sSecurityEnabled);SetupWebEAPropDivElement('user',sFormattedUser);SetupWebEAPropDivElement('review',sReviewSessionName);$( "#main-page-overlay" ).show();$( "#webea-about-dialog" ).show();}},error:function(jqXHR){if ( jqXHR.status === 200 ){WebeaAlert(GetTranslateString('unable_to_retrieve_server_details'));}else{WebeaAlert(GetTranslateString('error_retrieving_server_details') + '\n\t' + jqXHR.responseText);}},complete:function(){$("#main-busy-loader1").hide();$("#miniprops-busy-loader").hide();}});}function SetupWebEAPropDivElement(sEleName,sValue){if ( sValue === ''){$( "#webea-about-line-" + sEleName ).hide();$( "#webea-about-line-value-" + sEleName ).val('');}else{$( "#webea-about-line-" + sEleName ).show();$( "#webea-about-line-value-" + sEleName ).text(sValue);}}function OnClickWatchlistItem(sClause,sInName){LoadObject('watchlistresults','false','',sClause,sInName,'images/element16/watchlistresults.png');}function OnLoad_SetupSpecialCtrls(sRichEditCtrlsCSV,sDatePickerCtrlsCSV){OnLoad_SetupRichEditCtrls(sRichEditCtrlsCSV);OnLoad_DatePickerCtrls(sDatePickerCtrlsCSV);OnLoad_ConvertPasteToPlainText();}function OnLoad_SetupRichEditCtrls(sCtrlsCSV){if ( sCtrlsCSV != ''){var a = sCtrlsCSV.split(",");if (a.length > 0){for (var i=0;i < a.length;i++){var ele = document.getElementById(a[i]);if (ele!=null){new nicEditor({buttonList:['bold','italic','underline','ol','ul','superscript','subscript','forecolor','link','unlink','html'],maxHeight:300,minwidth:300}).panelInstance(a[i]);$('.nicEdit-panelContain').parent().width('100%');$('.nicEdit-panelContain').parent().next().width('100%');}}}}}function OnLoad_ConvertPasteToPlainText(){$(".nicEdit-main").on('paste',function (e){e.preventDefault();var text;var clp = (e.originalEvent || e).clipboardData;if (clp === undefined || clp === null){text = window.clipboardData.getData("text") || "";if (text !== ""){text = text.replace(/(?:\r\n|\r|\n)/g,'<br />');if (window.getSelection){var newNode = document.createElement("span");newNode.innerHTML = text;window.getSelection().getRangeAt(0).insertNode(newNode);}else{document.selection.createRange().pasteHTML(text);}}}else{text = clp.getData('text/plain') || "";if (text !== ""){document.execCommand('insertText',false,text);}}});}function OnLoad_DatePickerCtrls(sCtrlsCSV){if ( sCtrlsCSV != ''){var a = sCtrlsCSV.split(",");if (a.length > 0){for (var i=0;i < a.length;i++){if ( a[i] != '' ){var a2 = a[i].split("|");var sTextField = a2[0];var sImage = a2[1];$('#' + sTextField).datepick({showOnFocus:false,showTrigger:'#' + sImage,dateFormat:'yyyy-mm-dd',showAnim:'',showSpeed:10});}}}}}function OnJoinLeaveReviewSession(sReviewElementGUID,sReviewElementName,sCurrObjectGUID){var settingArray = [['review_session',sReviewElementGUID],['review_session_name',sReviewElementName]];var settingJSONArray = JSON.stringify(settingArray);$.get('./data_api/set_setting.php?json_var_array=' + settingJSONArray,function (data){if (sReviewElementGUID === sCurrObjectGUID){if ( sReviewElementGUID!=='' ){document.getElementById('review-session-join-button').setAttribute('disabled','');document.getElementById('review-session-leave-button').removeAttribute('disabled');}else{document.getElementById('review-session-join-button').removeAttribute('disabled');document.getElementById('review-session-leave-button').setAttribute('disabled','');}}if ( sCurrObjectGUID!=='' ){if ($("#review-section").css("display") === "block"){RefreshDiscussionSection(sCurrObjectGUID,'');}else{RefreshCurrent();}}var sPayload = 'reviewguid=' + encodeURIComponent(sReviewElementGUID) + '&reviewname=' + encodeURIComponent(sReviewElementName);$.ajax({type:"POST",cache:false,url:'statusbar.php',data:sPayload,success:function(sHTML){document.getElementById('main-statusbar').innerHTML = sHTML;},error:function(jqXHR){WebeaAlert( 'OnJoinLeaveReviewSession:' + jqXHR.responseText);}});});}function RefreshStatusBarIcons(sGUID){$.ajax({type:"POST",cache:false,url:'statusbar.php',data:{guid:sGUID,action:'icon_refresh'},success:function(sHTML){$('#main-statusbar-left').html($(sHTML).find('#main-statusbar-left').html());},error:function(jqXHR){}});}function OnRequestDiagramRegenerate(sGUID){if ( sGUID!=='' ){var sPayload;sPayload = 'objectguid=' + sGUID;$.ajax({type:"POST",cache:false,url:'./data_api/request_diagramgenerate.php',data:sPayload,success:function(sErrorMsg){sErrorMsg = StrTrim(sErrorMsg);if ( sErrorMsg === '' ){document.getElementById('generatediagram-action-button').setAttribute('disabled','');document.getElementById('diagram-regeneration-label-line').removeAttribute('style');}else{if ( CheckFatalError(sErrorMsg) ){WebeaAlert( 'OnRequestDiagramRegenerate:' + sErrorMsg );}}},error:function(jqXHR){WebeaAlert( 'OnRequestDiagramRegenerate:' + jqXHR.responseText );}});}}function OnShowCurrentLink(){sLink = $('input[name=current_guid]').val();sFullURL = $('input[name=current_url]').val();if (sLink!== null && sLink!==''){$( "#webea-show-link-textarea" ).val(sLink);$( "#webea-show-fulllink-textarea" ).val(sFullURL);$( "#main-page-overlay" ).show();$( "#webea-show-link-dialog" ).show();}else{WebeaErrorMessage('GUID and Full URL are not available for this page');}}function OnPromptForGotoGUID(){$( "#webea-goto-link-textarea" ).val('');$( "#main-page-overlay" ).show();$( "#webea-goto-link-dialog" ).show();$( "#webea-goto-link-textarea" ).focus();$( "#navbar-search-menu" ).hide();}function OnGotoGUIDTextKeypress(event){if (event){if (event.keyCode === 13){OnWebEAGotoGUID();return false;}}return true;}function OnWebEAGotoGUID(){g_bIsLoadGUID = true;var sLink = $("#webea-goto-link-textarea").val();LoadObjectByGUID(sLink,false);}function LoadObjectByGUID(sLink,bReplaceLastState){if (sLink !== null && sLink !== ''){try{if ( sLink.substr(0,7) === 'matrix_' ){var sHyper = sLink.substr(7);if (sHyper !== null && sHyper !== ''){LoadObject('matrix','','',sHyper,'Matrix - ' + sHyper,'images/element16/matrix.png');}}else{sLink = sLink.replace(/^\s+|\s+$/gm,'');sLink = sLink.replace(/[{}]/g,'');sLink = sLink.replace('%7B','');sLink = sLink.replace('%7D','');if (sLink !== null && sLink !== ''){if (sLink.match(/^[A-Fa-f0-9]{8}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{12}$/)){$.ajax({type:"GET",cache:false,url:"data_api/lookup_object.php",data:{rawguid:sLink},beforeSend:function(){$("#navbar-busy-loader").show();},success:function(sResponse){sResponse = StrTrim(sResponse);if (sResponse.substr(0,8) == 'success:'){var sGUID = StrTrim(sResponse.substr(8));LoadDiagramObject(sGUID,bReplaceLastState);}else{var sErrorMsg = sResponse.substr(7);if ( CheckFatalError(sErrorMsg) ){WebeaAlert(GetTranslateString('guid_not_found_in_model') );}}},error:function(jqXHR){WebeaAlert(GetTranslateString('error_occurred_while_locating_guid') + '\n\t' + jqXHR.responseText);},complete:function(){$("#navbar-busy-loader").hide();}});}else{WebeaAlert(GetTranslateString('invalid_guid_format'));}}else{WebeaAlert(GetTranslateString('blank_guid_supplied'));}}}catch(err){WebeaAlert(GetTranslateString('invalid_webea_guid'));}}$( "#main-page-overlay" ).hide();$( "#webea-goto-link-dialog" ).hide();}function LoadObjectFromString(s,bAdd2History){if (typeof s !== 'undefined'){if (s !== ''){var a = JSON.parse(s);if (a !== null){var sGUID = '';var sHasChild = '';var sLinkType = '';var sHyper = '';var sName = '';var sImageURL = '';sGUID = a['guid'];sHasChild = a['haschild'];sLinkType = a['linktype'];sHyper = a['hyper'];sName = a['name'];sImageURL = a['imageurl'];LoadObject(sGUID,sHasChild,sLinkType,sHyper,sName,sImageURL,bAdd2History);}}}}function WebeaAlert(sText,sTitle){var sConsoleStr = '';if (sText !== null && sText !== ''){if (typeof sTitle !== 'undefined' && sTitle !== '' ){$( "#webea-messagebox-title" ).text(sTitle);sConsoleStr = sTitle + ' ';}$( "#webea-messagebox-line-value-message" ).html(sText);$( "#main-page-overlay" ).show();$( "#webea-messagebox-dialog" ).show();Write2Console(sConsoleStr + sText);}}function WebeaSuccessMessage(sText){if ((sText.length > 2000) && ((sText.includes("<tr>")==true))){Write2Console(sText);sText = 'Error:Invalid message format,see browser console for details';}else{sText = StrTrim(sText);}if (sText !== null && sText !== ''){$( "#webea-success-message" ).stop();$( "#webea-success-message" ).hide();$( "#webea-error-message" ).stop();$( "#webea-error-message" ).hide();$( "#webea-success-message-text" ).html(sText);$( "#webea-success-message" ).fadeIn(300);}$("#webea-success-message").delay(3000).fadeOut(300);}function WebeaErrorMessage(sText,bStayVisible,sTargetID){if((typeof sTargetID !== 'undefined') &&($(sTargetID).length)){$(sTargetID).html(sText);}else{bStayVisible = typeof bStayVisible !== 'undefined' ? bStayVisible:false;if ((sText.length > 2000) && ((sText.includes("<tr>")==true))){Write2Console(sText);sText = 'Error:Invalid message format,see browser console for details';}else{sText = StrTrim(sText);}if (sText !== null && sText !== ''){if(!$('#webea-error-message').is(':visible')){window.top.$( "#webea-success-message" ).stop();window.top.$( "#webea-success-message" ).hide();window.top.$( "#webea-error-message" ).stop();window.top.$( "#webea-error-message" ).hide();window.top.$( "#webea-error-message-text" ).html(sText);window.top.$( "#webea-error-message" ).fadeIn(300);}}if (!bStayVisible){$(".webea-error-close-button").hide();window.top.$("#webea-error-message").delay(5000).fadeOut(300);}else{$(".webea-error-close-button").show();}}}function WebeaWarningMessage(sText){if ((sText.length > 2000) && ((sText.includes("<tr>")==true))){Write2Console(sText);sText = 'Error:Invalid message format,see browser console for details';}else{sText = StrTrim(sText);}if (sText !== null && sText !== ''){$( "#webea-warning-message" ).stop();$( "#webea-warning-message" ).hide();$( "#webea-warning-message-text" ).html(sText);$( "#webea-warning-message" ).fadeIn(300);}$("#webea-warning-message").delay(5000).fadeOut(300);}function OnShowStereotypeList(e,sStereotypeCSV){$('#webea-stereotype-list-items').empty();if ( sStereotypeCSV !=='' ){var a = sStereotypeCSV.split(",");if (a.length > 0){for (var i=0;i < a.length;i++){$('<div/>').text(a[i]).addClass("webea-stereotype-list-item").appendTo('#webea-stereotype-list-items');}var eleStereoLst = document.getElementById('webea-stereotype-list');if ( eleStereoLst != null){eleStereoLst.style.right = '';eleStereoLst.style.top = e.clientY + 'px';eleStereoLst.style.left = (e.clientX-30) + 'px';eleStereoLst.style.display = "block";var iRightEdge = parseInt(eleStereoLst.style.left) + parseInt(eleStereoLst.offsetWidth);var iCliWidth = window.innerWidth;if ( iRightEdge > iCliWidth){eleStereoLst.style.left = '';eleStereoLst.style.right = '10px';}}}}}function ShowMenu(element){if ( element != null ){$(element.nextElementSibling).toggle('fade',{},300);}}function ShowMenuByID(id){id = '#'+ id;if ( id != null ){$(id).toggle('fade',{},300);}}function ShowElement(element){if ( element != null ){$(element).toggle();}}function ShowChatSelectMenu(ele){if ( ele != null ){$(ele).next().toggle();}}function HideMenu(e,buttonID,menuID){var button = $(buttonID);var container = $(menuID);if ( ( !container.is(e.target) &&container.has(e.target).length === 0) &&!button.is(e.target) ){container.hide();}}function SetDiscussState(sGUID,type,value,tooltip,ele){var sPayload = 'guid='+ sGUID + '&type=' + type + '&value=' + value;var requestSettings ={type:'POST',url:'./data_api/update_discussionstate.php',data:sPayload,success:function(response){var sResults = StrTrim(response);if ( sResults === '' ){if (type === 'status'){if (value === 'Open' || value === 'Awaiting Review' || value === 'Closed'){el = document.getElementsByClassName('statusimage_'+ sGUID);for (var i = 0;i < el.length;i++){if ( el[i] != null){var sLC = String(value);sLC = sLC.toLowerCase();if (sLC == 'awaiting review')sLC = 'await';else if (sLC == 'closed')sLC = 'complete';el[i].setAttribute('class','propsprite-discussstatus' + sLC + ' statusimage_'+ sGUID);el[i].setAttribute('title',tooltip);}}}$(ele).parent().parent().hide();}else if (type === 'priority'){if (value === 'High' || value === 'Medium' || value === 'Low' || value === 'None'){el = document.getElementsByClassName('priorityimage_'+ sGUID);for (var i = 0;i < el.length;i++){if ( el[i] != null){var sLC = String(value);sLC = sLC.toLowerCase();if (sLC == 'medium')sLC = 'med';el[i].setAttribute('class','propsprite-discusspriority' + sLC + ' '+'priorityimage_'+ sGUID);el[i].setAttribute('title',tooltip);}}}$(ele).parent().parent().hide();}LoadServerSystemoutput();}else{if ( CheckFatalError(sResults) ){WebeaAlert(GetTranslateString('error_setting_discussion_state') + ' ' + sResults);}}},error:function(jqXHR){WebeaAlert("SetDiscussState:" + jqXHR.responseText);}};$.ajax(requestSettings);}function CheckFatalError(sErrorMsg){var bOK = true;if ( sErrorMsg == '' ){var sErrorCode = $("#webea-last-oslc-error-code").text();var sErrorMsg = $("#webea-last-oslc-error-msg").text();if ( sErrorCode !== '' ){sErrorMsg = sErrorMsg.toLowerCase();if ( sErrorCode === '403' || sErrorMsg === 'invalid user security identifier'){ShowFatalTimeout(true);bOK = false;}}}else{if (sErrorMsg == '403 - Invalid User Security Identifier' ||sErrorMsg == '403 - Invalid User Authentication Identifier' ){bOK = false;ShowFatalTimeout(true);}}return bOK;}function ShowFatalTimeout(bIsOSLC){$("#main-page-overlay").show();$("#webea-session-timeout").show();if (bIsOSLC){$("#session-timeout-type2").show();}else{$("#session-timeout-type2").hide();}window.clearInterval(g_TimerRef);}function ShowBrowser(){bIsDiagram = $("#main-diagram-image").length;bBrowserIsLoaded = $("#main-browser-view").length;bBrowserIsHidden = $("#main-browser-view").is(":hidden");bBrowserIsEnabled = $("#mainsprite-navbarbrowsericon").hasClass("mainsprite-navbarbrowsercollapse");if (bBrowserIsEnabled){bShow = 'false';}else{bShow = 'true';}$.get('./data_api/set_setting.php?varname=show_browser&varval=' + bShow,function (data){RefreshCurrent();});}function ShowPropertiesView(bShow){var bIsDiagram = $("#main-diagram-image").length;var bBrowserIsVisible = $("#main-browser-view").is(":visible");var bIsPacakgeList = $("#main-package-list").length;var bPropsIsLoaded = $("#main-mini-properties-view").length;var bPropsIsHidden = $("#main-mini-properties-view").is(":hidden");var sPropsViewClass = ' show-miniprops';if (bBrowserIsVisible){sPropsViewClass = ' show-browserminiprops';}if (bPropsIsHidden || !bPropsIsLoaded){bShow = 'true';}else{bShow = 'false';}if(!bIsDiagram){$("#mainview-busy-loader").show();ShowPropertiesViewBusyLoader();}$.get('./data_api/set_setting.php?varname=show_propertiesview&varval=' + bShow,function (data){if(bShow === 'true'){if (!bPropsIsLoaded){var sEmptyPropsView = '<div id="miniprops-busy-loader" class=" '+sPropsViewClass+'" style="display:none;"><img src="images/navbarwait.gif" alt="" class="miniprops-spinner" width="26" height="26"></div><div id="main-mini-properties-view" class=" '+sPropsViewClass+'" style="display:none;"><div id="mini-properties-view-section"></div></div>';if(bIsDiagram)$('#main-diagram-image').after(sEmptyPropsView);else if(bIsPacakgeList){$('#main-package-list').after(sEmptyPropsView);}else{$('#properties-container').after(sEmptyPropsView);}UpdateSectionClasses();}var svgOverlay = $('#svg-overlay').html();if (svgOverlay === undefined || svgOverlay === ''){if(bIsDiagram){RefreshCurrent();}else{RefreshPropertiesView();}}else{var sDiagramSelectionGUID = $("#svg-overlay").attr("guid");var sPropertiesViewGUID = $("#current-props-view-guid").val();if(sDiagramSelectionGUID === sPropertiesViewGUID){$("#main-mini-properties-view").show();}else{RefreshCurrent();}UpdateSectionClasses();}}else{$("#main-mini-properties-view").hide();UpdateSectionClasses();}});}function RefreshPropertiesView(){if (typeof(window.history ) !== 'undefined'){if (window.history.state !== null && typeof(window.history.state ) !== 'undefined'){var sGUID = window.history.state.guid;}else{var sGUID = g_sLastGUID;}}var showingMainProps = false;var showingContents = false;if ($('#properties-main').length){showingMainProps = true;}if (($('#main-package-list').length) ||($('#main-package-icon').length)){showingContents = true;}if ( sGUID !== '' ){$.ajax({type:"POST",cache:false,url:"miniproperties.php",data:{objectguid:sGUID,bShowingMainProps:showingMainProps,bShowingContents:showingContents},beforeSend:function(){},success:function(sHTML){document.getElementById('mini-properties-view-section').innerHTML = sHTML;$("#main-mini-properties-view").show();UpdateSectionClasses();LoadServerSystemoutput();},error:function(jqXHR){Write2Console('LoadMinipropsObject:' + jqXHR.statusText);},complete:function(){$("#miniprops-busy-loader").hide();}});}else{$("#main-mini-properties-view").show();UpdateSectionClasses();}}function UpdateSectionClasses(){var bPropsIsLoaded = $("#main-mini-properties-view").length;var bPropsIsVisible = $("#main-mini-properties-view").is(":visible");var bBrowserIsLoaded = $("#main-browser-view").length;var bBrowserIsVisible = $("#main-browser-view").is(":visible");$(".main-view").removeClass("show-browser").removeClass("show-browserminiprops").removeClass("show-miniprops");$("#mainview-busy-loader").removeClass("show-browser").removeClass("show-browserminiprops").removeClass("show-miniprops");$(".mainview-summary-section").hide();if(bBrowserIsLoaded && bBrowserIsVisible){if(bPropsIsVisible){$(".main-view").addClass("show-browserminiprops");$("#mainview-busy-loader").addClass("show-browserminiprops");$(".mainview-summary-section").hide();}else{$(".main-view").addClass("show-browser");$("#mainview-busy-loader").addClass("show-browser");$(".mainview-summary-section").show();}}else{if(bPropsIsVisible){$(".main-view").addClass("show-miniprops");$("#mainview-busy-loader").addClass("show-miniprops");$(".mainview-summary-section").hide();}}$("#mainview-busy-loader").hide();$("#miniprops-busy-loader").hide();}function ShowSystemOutput(bShow){if ($("#hamburger-systemoutput").hasClass("mainsprite-tick")){$("#hamburger-systemoutput").removeClass("mainsprite-tick");bShow = 'false';}else{$("#hamburger-systemoutput").addClass("mainsprite-tick");bShow = 'true';}$.get('./data_api/set_setting.php?varname=show_system_output&varval=' + bShow,function (data){window.location.reload();});}function OnFormViewMatrix(event){event.preventDefault();var sPayload = $('#matrix-profile').val();sSourcePackage = $("#matrix-source-package").html();sTargetPackage = $("#matrix-target-package").html();sSourceType = $("#matrix-source-type").html();sTargetType = $("#matrix-target-type").html();sLinkType = $("#matrix-link-type").html();sLinkDirection = $("#matrix-link-direction").html();if ($('#matrix-profile').prop('selectedIndex') === 0){WebeaErrorMessage('Please select a Profile');}else{if (sSourcePackage == '' || sTargetPackage == '' || sSourceType == '' || sTargetType == '' || sLinkType == '' || sLinkDirection == ''){WebeaErrorMessage(GetTranslateString('matrix_profile_incomplete'));}else{LoadObject('matrix','','',sPayload,'Matrix - ' + sPayload,'images/element16/matrix.png');}}}function OnSelectMatrixProfile(e){$("#main-busy-loader1").show();sPayload = 'profile=' + encodeURIComponent(e.options[e.selectedIndex].text);if (e.selectedIndex === 0){$("#matrix-source-package").html("");$("#matrix-target-package").html("");$("#matrix-source-type").html("");$("#matrix-target-type").html("");$("#matrix-link-type").html("");$("#matrix-link-direction").html("");$("#main-busy-loader1").hide();$("#main-busy-loader1").hide();$("#matrix-profile-view-matrix").prop('disabled',true);}else{$("#matrix-profile-view-matrix").prop('disabled',false);$.ajax({type:"POST",cache:false,dataType:"text json",url:'./data_api/get_matrixprofilesettings.php',data:sPayload,success:function(aSettings){if (aSettings != null){var sLastOSLCError = aSettings['lastoslcerror'];if ( sLastOSLCError === '' ){var sSourcePackageName = aSettings['sourcepackagename'];var sTargetPackageName = aSettings['targetpackagename'];var sSourcePackageGUID = aSettings['sourcepackageguid'];var sTargetPackageGUID = aSettings['targetpackageguid'];var sSourceType = aSettings['sourcetype'];var sTargetType = aSettings['targettype'];var sLinkType = aSettings['linktype'];var sLinkDirection = aSettings['linkdirection'];var aOptions = aSettings['options'];$("#matrix-source-package").html(sSourcePackageName);$("#matrix-target-package").html(sTargetPackageName);$("#matrix-source-type").html(sSourceType);$("#matrix-target-type").html(sTargetType);$("#matrix-link-type").html(sLinkType);$("#matrix-link-direction").html(sLinkDirection);}else{if (CheckFatalError(sLastOSLCError) ){$("#matrix-source-package").html( '');$("#matrix-target-package").html( '');$("#matrix-source-type").html( '');$("#matrix-target-type").html( '');$("#matrix-link-type").html( '');$("#matrix-link-direction").html( '');}}}},error:function(jqXHR){if ( CheckFatalError(sLastOSLCError) ){WebeaAlert('Error:' + jqXHR.responseText);}},complete:function(jqXHR){$("#main-busy-loader1").hide();}});}}function OnSetAllCheckboxes(sCheckState){var b = (sCheckState==='true' || sCheckState==='True');$('input').prop('checked',b);}function GetTranslateString(sElementID){var sRet = '';var sText = $("#" + sElementID).text();if ( sText !== '' ){sRet = sText;}else{Write2Console('GetTranslateString:NO value found for ElementID=' + sElementID);sRet = sElementID.replace('_',' ');}return sRet;}function LoadServerSystemoutput(){var sysout = $("#webea-system-output");if ( sysout.length ){var sStatement = '';var iData;var sSystemOutputHTML = '';var data = document.getElementsByClassName('webea-sysout-data');for (iData = 0;iData < data.length;iData++){if ( data[iData].hasChildNodes() ){var children = data[iData].childNodes;for (var i = 0;i < children.length;i++){sStatement = children[i].innerHTML;sStatement = sStatement.replace('<div class="webea-sysout-data-entry">','');sStatement = sStatement.replace('</div>','');sSystemOutputHTML += '<div class="sysout-entry">';sSystemOutputHTML += sStatement;sSystemOutputHTML += '</div>';}}data[iData].innerHTML = '';sStatement = '';}sysout.append(sSystemOutputHTML);sysout[0].parentNode.scrollTop = sysout[0].scrollHeight}}function OnClickClearSystemOutput(){var sysout = $("#webea-system-output");if ( sysout.length ){sysout.html('');}}function OnClickCopySystemOutput(){var sysout = $("#webea-system-output");if ( sysout.length ){var sMessages = sysout.html();sMessages = sMessages.replace(/<div class="sysout-entry">/g,'');sMessages = sMessages.replace(/<\/div>/g,'\r\n');CopyTextToClipboard(sMessages);}}function CopyTextToClipboard(text){var textArea = document.createElement("textarea");textArea.style.position = 'fixed';textArea.style.top = 0;textArea.style.left = 0;textArea.style.width = '2em';textArea.style.height = '2em';textArea.style.padding = 0;textArea.style.border = 'none';textArea.style.outline = 'none';textArea.style.boxShadow = 'none';textArea.style.background = 'transparent';textArea.value = text;document.body.appendChild(textArea);textArea.select();try{var successful = document.execCommand('copy');if ( successful ){WebeaSuccessMessage('System Output was copied to clipboard');}else{WebeaErrorMessage('Unable to copy the System Output to clipboard');}}catch (err){WebeaErrorMessage('Unable to copy the System Output to clipboard');}document.body.removeChild(textArea);}function CopyText(inputID){var $input = $(inputID);bWasHidden = false;if(($input.is(":hidden"))){bWasHidden = true;$input.show();}if (navigator.userAgent.match(/ipad|ipod|iphone/i)){var el = $input.get(0);var editable = el.contentEditable;var readOnly = el.readOnly;el.contentEditable = true;el.readOnly = true;var range = document.createRange();range.selectNodeContents(el);var sel = window.getSelection();sel.removeAllRanges();sel.addRange(range);el.setSelectionRange(0,999999);el.contentEditable = editable;el.readOnly = readOnly;}else{$input.select();}document.execCommand("copy");$input.blur();if(bWasHidden){$input.hide();}WebeaSuccessMessage('Copied text to Clipboard');}function ToggleVisibility(element){$(element).toggle();}function ToggleSectionAndIcon(element,icon){iconExpanded = $(icon).attr("expanded");if(iconExpanded === 'false'){$(icon).attr("expanded","true");}else{$(icon).attr("expanded","false");}$(element).toggle();}function CheckBrowserVisibility(){if($("#main-browser-view").css("display") === 'none'){$.get('./data_api/set_setting.php?varname=show_browser&varval=' + 'false',function (data){$("#mainsprite-navbarbrowsericon").removeClass("mainsprite-navbarbrowsercollapse").addClass("mainsprite-navbarbrowserexpand");$("#statusbar-browser-button").prop("title",GetTranslateString('navbar_show_browser'));});if($("#main-mini-properties-view").css("display") === 'none'){$.get('./data_api/set_setting.php?varname=show_propertiesview&varval=' + 'false',function (data){$("#mainsprite-navbarpropsicon").addClass('mainsprite-navbarpropsexpand').removeClass('mainsprite-navbarpropscollapse');$("#statusbar-properties-button").prop("title",GetTranslateString('navbar_show_properties'));});}}}function ShowSection(id){filterProps = $("#properties-filter-button").attr("filterprops");sessionStorage.setItem("current_props_tab",id);id = id.replace(/\s/g,'');buttonID = '#props-tab-'+id;if (id.slice(-1) === 's'){id = id.substring(0,id.length - 1);}id = '#' + id + '-section';if (id === '#summary-section')id = '#review-summary-section';if(id ==='#DMNExpression-section')id = '#dmnexpression-section';if(id ==='#comment-section')id = '#comments-section';if (filterProps === "false"){$(id).get(0).scrollIntoView();}else{$(".properties-tab").css("background-color","");$(buttonID).css("background-color","#eee");$(id).show();$(id).siblings().hide();}}function ReturnToList(ele){itemDetails = $(ele).parent().parent();list = $(ele).parent().parent().parent().prev();$(itemDetails).hide();$(list).show();$(list).get(0).scrollIntoView();}function FilterProperties(ele){bFilter = $(ele).attr('filterprops');if (bFilter === 'false'){bFilter = 'true';}else{bFilter = 'false';}$.get('./data_api/set_setting.php?varname=filter_properties&varval=' + bFilter,function (data){RefreshCurrent();});}function DiagramZoom(ele){zoomVal = $(ele).attr("zoom-val");refreshType = 'zoom';if (zoomVal !== 'NA'){$.get('./data_api/set_setting.php?varname=diagram_zoom&varval=' + zoomVal,function (data){RefreshDiagram('zoom');});}}function SelectFeature(id,label,guid){$.get('./data_api/set_setting.php?varname=selected_features&varval=' + id,function (data){LoadMinipropsObjectInternal(guid);});}function ToggleScrolling(){sScrollState = $("#scroll-mode").html();if (sScrollState === 'Off'){$.get('./data_api/set_setting.php?varname=ios_scroll&varval=true',function (data){});$("#scroll-mode").html('On');$("#scroll-mode-icon").addClass("propsprite-greendot").removeClass("propsprite-reddot");if ($('#diagrammap').length)$("#diagrammap").next().get(0).useMap = "";}else if (sScrollState === 'On'){$.get('./data_api/set_setting.php?varname=ios_scroll&varval=false',function (data){});$("#scroll-mode-icon").addClass("propsprite-reddot").removeClass("propsprite-greendot");$("#scroll-mode").html('Off');if ($('#diagrammap').length)$("#diagrammap").next().get(0).useMap = "#diagrammap";}}function OnSendMail(event){event.preventDefault();var listType = $("#mail-list-tb").attr("list-type");var collabTab = 'modelmail';if(listType === 'sent')collabTab ='modelmailsent';SaveNicEditorData( 'edit-model-mail-field' );var sPayload = 'action=createmail&' + $(".create-model-mail-form").serialize();var requestSettings ={type:'POST',url:'./data_api/create_modelmail.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){WebeaSuccessMessage('Message Sent');LoadObject('collaborate','',collabTab,'','Collaborate','propsprite-discussion');$(".default-dialog").hide();},complete:function(){$("#main-page-overlay").hide();$("#main-busy-loader1").hide();},error:function(jqXHR){WebeaErrorMessage(jqXHR.responseText);}};$.ajax(requestSettings);}function MailSetFlag(sFlag){mailid = $(".mail-list-row-selected").attr("mailid");readState = $(".mail-list-row-selected").attr("read");var sPayload = 'read='+readState+'&flag='+sFlag+'&identifier='+mailid;var requestSettings ={type:'POST',url:'./data_api/update_modelmail.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);var flagLower = sFlag.toLowerCase();$('.mail-list-row-selected').find('#mail-flag-button-icon').removeClass().addClass('mainsprite').addClass('mail-flag-'+flagLower);},complete:function(){$("#mail-ellipsis-menu").hide();$("#main-busy-loader1").hide();},error:function(jqXHR){console.log(jqXHR);}};$.ajax(requestSettings);}function EditNote(objectguid){$.ajax({type:"POST",cache:false,url:"maineditelementnote.php",data:{objectguid:objectguid},beforeSend:function(){},success:function(response){$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();},error:function(jqXHR){},complete:function(){}});}function EditResource(guid,resource,role,resourceid){$.ajax({type:"POST",cache:false,url:"maineditelementresalloc.php",data:{guid:guid,resource:resource,role:role,resourceid:resourceid},beforeSend:function(){},success:function(response){$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();$("#edit-elementresalloc-resource-field").focus();},error:function(jqXHR){},complete:function(){}});}function EditTest(guid,classtype,name,testid){$.ajax({type:"POST",cache:false,url:"maineditelementtest.php",data:{guid:guid,classtype:classtype,name:name,testid:testid},beforeSend:function(){},success:function(response){$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();},error:function(jqXHR){},complete:function(){}});}function AddTest(guid){$.ajax({type:"POST",cache:false,url:"mainaddelementtest.php",data:{guid:guid},beforeSend:function(){},success:function(response){$("#element-hamburger-menu").hide();$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();$("#add-elementtest-name-field").focus();},error:function(jqXHR){},complete:function(){}});}function AddResAlloc(guid){$.ajax({type:"POST",cache:false,url:"mainaddelementresalloc.php",data:{guid:guid},beforeSend:function(){},success:function(response){$("#element-hamburger-menu").hide();$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();$("#add-elementresalloc-resource-field").focus();},error:function(jqXHR){},complete:function(){}});}function AddChgMgmt(guid,chmgmttype){$.ajax({type:"POST",cache:false,url:"mainaddelementchgmgmt.php",data:{guid:guid,chmgmttype:chmgmttype},beforeSend:function(){},success:function(response){$("#element-hamburger-menu").hide();$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();$("#add-elementchgmgmt-name-field").focus();},error:function(jqXHR){},complete:function(){}});}function AddObject(guid,parentname){$.ajax({type:"POST",cache:false,url:"mainaddelement.php",data:{guid:guid,parentname:parentname},beforeSend:function(){},success:function(response){$("#element-hamburger-menu").hide();$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();$("#add-element-name-field").focus();},error:function(jqXHR){},complete:function(){}});}function AddModelRoot(guid,parentname){addobjecttype = 'modelroot';$.ajax({type:"POST",cache:false,url:"mainaddrootpackage.php",data:{guid:guid,parentname:parentname,addobjecttype:addobjecttype},beforeSend:function(){},success:function(response){$("#element-hamburger-menu").hide();$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();$("#add-element-name-field").focus();},error:function(jqXHR){},complete:function(){}});}function AddViewPackage(guid,parentname){addobjecttype = 'view';$.ajax({type:"POST",cache:false,url:"mainaddrootpackage.php",data:{guid:guid,parentname:parentname,addobjecttype:addobjecttype},beforeSend:function(){},success:function(response){$("#element-hamburger-menu").hide();$(".default-dialog").replaceWith(response);$("#main-page-overlay").show();$(".default-dialog").show();},error:function(jqXHR){},complete:function(){}});}function CloseDialog(){unsaved = false;$("#webea-prompt-unsaved-changes-dialog").hide();$("#main-page-overlay").hide();$(".default-dialog").hide();$("input").blur();$("textarea").blur();}function CloseParentDialog(ele){$(ele).closest('.dialog').hide();$("#main-page-overlay").hide();}function CloseVideoDialog(){$("video")[0].pause();$("video")[0].currentTime = 0;$("video")[0].load();$("#main-page-overlay").hide();$(".video-dialog").hide();}function CloseContextMenu(ele){$(ele).closest(".contextmenu").hide();}function CloseSelectObjectDialog(){unsaved = false;$("#main-page-overlay").hide();$(".select-object-dialog").hide();$("input").blur();$("textarea").blur();}function CloseConfigPropsDialog(){unsaved = false;$("#webea-prompt-unsaved-changes-dialog").hide();$("#main-page-overlay").hide();$("#config-props-dialog").hide();}function OpenKBShortcutDialog(){$("#main-page-overlay").show();$("#kb-shortcut-dialog").show();}function CloseKBShortcutDialog(){$("#main-page-overlay").hide();$("#kb-shortcut-dialog").hide();}function OnClickCloseDialogButton(){unsaved = unsaved || false;if (unsaved){$("#prompt-overlay").show();$("#webea-prompt-unsaved-changes-dialog").show();$("#save-changes-yes-button").focus();}else{CloseDialog();}}function DiscardAndClose(){$("#prompt-overlay").hide();CloseDialog();}function ConfirmSaveAndClose(){$("#prompt-overlay").hide();$("#webea-prompt-unsaved-changes-dialog").hide();$(".dialog-button-ok").click();}function RefreshNotes(sGUID){$.ajax({type:"POST",cache:false,url:"mainview.php",data:{objectguid:sGUID},beforeSend:function(){$("#main-busy-loader1").show();},success:function (response){notesPropsViewHTML = $(response).find('#note-mini-section').html();$('#note-mini-section').html(notesPropsViewHTML);notesMainViewHTML = $(response).find('#note-section').html();$('#note-section').html(notesMainViewHTML);LoadServerSystemoutput();},error:function(jqXHR){},complete:function(){$("#main-busy-loader1").hide();}});}function RefreshResource(sGUID,sResourceID){sResourceID = '#main_' + sResourceID;$.ajax({type:"POST",cache:false,url:"mainview.php",data:{objectguid:sGUID},beforeSend:function(){$("#main-busy-loader1").show();},success:function (response){if ($(response).find(sResourceID).length !== 0){$(sResourceID).find("td:nth-child(2)").html($(response).find(sResourceID).find("td:nth-child(2)").html());$(sResourceID).find("td:nth-child(3)").html($(response).find(sResourceID).find("td:nth-child(3)").html());$(sResourceID).find("td:nth-child(4)").html($(response).find(sResourceID).find("td:nth-child(4)").html());$(sResourceID).find("td:nth-child(5)").html($(response).find(sResourceID).find("td:nth-child(5)").html());$(sResourceID).find("td:nth-child(6)").html($(response).find(sResourceID).find("td:nth-child(6)").html());sMainViewRow2HTML = $(response).find(sResourceID).next().html();$(sResourceID).next().html(sMainViewRow2HTML);}else{sMainViewHTML = $(response).find('#resource-table').html();$('#resource-table').html(sMainViewHTML);}sPropsViewHTML = $(response).find('#resource-mini-section').html();$('#resource-mini-section').html(sPropsViewHTML);LoadServerSystemoutput();},error:function(jqXHR){},complete:function(){$("#main-busy-loader1").hide();}});}function RefreshTest(sGUID,sTestID){sTestID = '#main_' + sTestID;$.ajax({type:"POST",cache:false,url:"mainview.php",data:{objectguid:sGUID},beforeSend:function(){$("#main-busy-loader1").show();},success:function (response){if ($(response).find(sTestID).length !== 0){$(sTestID).find("td:nth-child(2)").html($(response).find(sTestID).find("td:nth-child(2)").html());$(sTestID).find("td:nth-child(3)").html($(response).find(sTestID).find("td:nth-child(3)").html());$(sTestID).find("td:nth-child(4)").html($(response).find(sTestID).find("td:nth-child(4)").html());$(sTestID).find("td:nth-child(5)").html($(response).find(sTestID).find("td:nth-child(5)").html());$(sTestID).find("td:nth-child(6)").html($(response).find(sTestID).find("td:nth-child(6)").html());sMainViewRow2HTML = $(response).find(sTestID).next().html();$(sTestID).next().html(sMainViewRow2HTML);}else{sMainViewHTML = $(response).find('#test-table').html();$('#test-table').html(sMainViewHTML);}sPropsViewHTML = $(response).find('#test-mini-section').html();$('#test-mini-section').html(sPropsViewHTML);LoadServerSystemoutput();},error:function(jqXHR){},complete:function(){$("#main-busy-loader1").hide();}});}function OnSaveAndClosePropsConfig(ele){var eleGUID = $("#current-props-view-guid").val();var selectedFeatures = '';var featuresOrder = '';var isFirstChecked = true;var isFirstFeature = true;$('.config-props-list-item').each(function(i,obj){var featureID = $(obj).attr("feature-id");var isChecked = $(obj).find('input').is(':checked');if(isFirstFeature){isFirstFeature=false;}else{featuresOrder += ',';}featuresOrder += featureID;if(isChecked){if(isFirstChecked){isFirstChecked=false;}else{selectedFeatures += ',';}selectedFeatures += featureID;}});var isHideEmptyChecked = 'true';if($("#onoffswitch_hide_empty").is(':checked')){isHideEmptyChecked = 'true';}else{isHideEmptyChecked = 'false';}var varArray = [['feature_order',featuresOrder],['selected_features',selectedFeatures],['propsview_hide_empty',isHideEmptyChecked]];var settingsJSON = JSON.stringify(varArray);$.get('./data_api/set_setting.php?json_var_array=' + settingsJSON,function (data){CloseDialog();LoadMinipropsObjectInternal(eleGUID);});}function PropsViewConfigResetOrder(){var aDefaultOrder = ['nt','tv','lt','at','op','fl','ra','mf','ch','dm','df','is','tk','ev','dc','dr'];aDefaultOrder.forEach(function(featureID,i){$('.config-props-list-item').each(function(i,obj){if($(obj).attr("feature-id") === featureID){$(obj).insertAfter($("#propsview-config-feature-list").children().last());}});});}function PropsViewConfigResetVisibility(){var aDefaultCheckedItems = ['nt'];$('.config-props-list-item').each(function(i,obj){var sFeatureID = $(obj).attr("feature-id");if(jQuery.inArray(sFeatureID,aDefaultCheckedItems) !== -1){$(obj).find('input').prop('checked',true);}else{$(obj).find('input').prop('checked',false);}});}function PropsViewConfigSetAllVisible(){$('.config-props-list-item').each(function(i,obj){$(obj).find('input').prop('checked',true);});}function PropsViewConfigSetNoneVisible(){$('.config-props-list-item').each(function(i,obj){$(obj).find('input').prop('checked',false);});}function ShowConfigProps(ele){$.ajax({type:"POST",cache:false,url:"propertiesviewconfig.php",beforeSend:function(){$("#main-busy-loader1").show();},success:function (response){$('.default-dialog').html(response);$( ".sortable" ).sortable();$( ".sortable" ).disableSelection();$("#main-page-overlay").show();$(".default-dialog").show();},error:function(jqXHR){},complete:function(){$("#main-busy-loader1").hide();}});}function SortTable(header,table,inverse){var inverse = false;$(header).wrapInner('<span title="Click to sort this column"/>').each(function(){var th = $(this),thIndex = th.index(),inverse = false;th.click(function(){thColumnIcon = $(this).find("div.sort-icon");if (thColumnIcon.hasClass('asc')){inverse = true;}else if (thColumnIcon.hasClass('desc')){inverse = false;}else{inverse = false;}table.find('td').not('.no-sort').filter(function(){return $(this).index() === thIndex;}).sortElements(function(a,b){if( $.text([a]).toLowerCase() == $.text([b]).toLowerCase() )return 0;return $.text([a]).toLowerCase() > $.text([b]).toLowerCase() ?inverse ? -1:1:inverse ? 1:-1;},function(){return this.parentNode;});$(".sort-icon").removeClass("asc").removeClass("desc");if (!inverse){thColumnIcon.addClass("asc");}else{thColumnIcon.addClass("desc");}});});}function ShowVideoDialog(ele){var sGUID = $(ele).attr("guid");$.ajax({type:"POST",cache:false,url:"videodialog.php",data:{objectguid:sGUID},beforeSend:function(){$("#main-busy-loader1").show();},success:function (response){$("#video-player-dialog").remove();$("#webea-main-content").append(response);$("#main-page-overlay").show();$("#video-player-dialog").show();},error:function(jqXHR){},complete:function(){$("#main-busy-loader1").hide();}});}function ShowImageViewerDialog(){var height = $(window).height();var width = $(window).width();maxImgHeight = height - 120;$(".image-viewer-body img").attr('style','max-height:'+maxImgHeight+'px' + ';');var imageHeight = $(".image-viewer-body img")[0].naturalHeight;var imageWidth = $(".image-viewer-body img")[0].naturalWidth;if ((imageWidth == 0) || (imageHeight == 0)){$(".image-viewer-body img").on('load',function(){var imageHeight = this.naturalHeight;var imageWidth = this.naturalWidth;RepositionImageViewerDialog(width,height,imageWidth,imageHeight);$("#image-viewer-dialog").show();$("#main-page-overlay").show();});}else{RepositionImageViewerDialog(width,height,imageWidth,imageHeight);$("#image-viewer-dialog").show();$("#main-page-overlay").show();}}function RepositionImageViewerDialog(width,height,imageWidth,imageHeight){var dialogHeight = imageHeight + 84;if (dialogHeight < height){var marginTop = (height - (dialogHeight)) / 2;$("#image-viewer-dialog").css("margin-top",marginTop);}if (imageWidth < width){var marginLeft = (width - imageWidth) / 2;$("#image-viewer-dialog").css("margin-left",marginLeft);}}function LoadMailMessagePreview(mailID){var linktype = 'preview';var listType = $("#mail-list-tb").attr("list-type");if (listType==='inbox'){linktype = 'preview';}else{linktype = 'previewsent';}LoadMailMessage(mailID,linktype);}function LoadMailMessage(mailID,linktype){$("#collab-context-menu").hide();if (linktype !== 'new'){mailID = $(".mail-list-row-selected").attr("mailid");}$.ajax({type:"POST",cache:false,url:"mailmessage.php",data:{mailid:mailID,linktype:linktype},beforeSend:function(){},success:function(sHTML){if((linktype === 'preview') ||(linktype === 'previewsent')){$("#mail-preview").html(sHTML);}else{$( "#main-page-overlay" ).show();$(".default-dialog").replaceWith(sHTML);$(".default-dialog").show();}},error:function(jqXHR){},complete:function(){}});}function MailMessageClose(){$( "#main-page-overlay" ).hide();$(".default-dialog").hide();}function SelectRecipient(user){$('input[name=recipient]').val($('input[name=recipient]').val() + user + ',');$("#select-recipient-menu").hide();}function SelectMessageFlag(flag){var flagLower = flag.toLowerCase();$('input[name=flag]').val(flag);$("#mail-flag-button-label").html(flag);$("#mail-flag-button").find("#mail-flag-button-icon").removeClass().addClass('mainsprite').addClass('mail-flag-'+flagLower);$("#select-flag-menu").hide();}function MailReply(){mailid = $(".mail-list-row-selected").attr("mailid");LoadMailMessage(mailid,'reply');}function MailReplyAll(){mailid = $(".mail-list-row-selected").attr("mailid");LoadMailMessage(mailid,'replyall');}function MailForward(){mailid = $(".mail-list-row-selected").attr("mailid");LoadMailMessage(mailid,'forward');}function MailView(){var mailid = $(".mail-list-row-selected").attr("mailid");var listType = $("#mail-list-tb").attr("list-type");console.log(listType);if (listType === 'inbox'){LoadMailMessage(mailid,'view');}else{LoadMailMessage(mailid,'viewsent');}}function MailMarkAsUnread(){var isRead = 'false';MailSetReadState(isRead);}function MailMarkAsRead(){var isRead = 'true';MailSetReadState(isRead);}function MailSetReadState(isRead){mailid = $(".mail-list-row-selected").attr("mailid");var sPayload = 'read='+isRead+'&identifier='+mailid;var requestSettings ={type:'POST',url:'./data_api/update_modelmail.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){var sResults = StrTrim(response);if (isRead==='true'){$(".mail-list-row-selected").attr("read","true");$("#mail-markunread-button").prop("disabled",false);$("#mail-markread-button").prop("disabled",true);}else if (isRead==='false'){$(".mail-list-row-selected").attr("read","false");$("#mail-markunread-button").prop("disabled",true);$("#mail-markread-button").prop("disabled",false);}},complete:function(){$("#mail-ellipsis-menu").hide();$("#main-busy-loader1").hide();},error:function(jqXHR){}};$.ajax(requestSettings);}function CollabChatSetHistoryTimeframe(ele){var timeframe = $(ele).attr("timeframe");timeframe = encodeURIComponent(timeframe);$.get('./data_api/set_setting.php?varname=chat_history_timeframe&varval=' + timeframe,function (data){ChatShowDialog(false);});}function CollabCommentsSetHistoryTimeframe(ele){var timeframe = $(ele).attr("timeframe");timeframe = encodeURIComponent(timeframe);$.get('./data_api/set_setting.php?varname=comment_history_timeframe&varval=' + timeframe,function (data){LoadObject('collaborate','','comments','','Collaborate','propsprite-discussion',false);});}function CollabDiscussionsSetHistoryTimeframe(ele){var timeframe = $(ele).attr("timeframe");timeframe = encodeURIComponent(timeframe);$.get('./data_api/set_setting.php?varname=discussion_history_timeframe&varval=' + timeframe,function (data){LoadObject('collaborate','','discussions','','Collaborate','propsprite-discussion',false);});}function CollabReviewsSetHistoryTimeframe(ele){var timeframe = $(ele).attr("timeframe");timeframe = encodeURIComponent(timeframe);$.get('./data_api/set_setting.php?varname=review_history_timeframe&varval=' + timeframe,function (data){LoadObject('collaborate','','reviews','','Collaborate','propsprite-discussion',false);});}function OnClickTableGroup(ele){var state = $(ele).attr("state");var group = $(ele).attr("group");group = '"'+group+'"';var tableID = $(ele).closest('table').attr('id');if (state === 'expanded'){$(".collapsible-row[group="+group+"]").hide();$(ele).attr("state","collapsed");}else{$(".collapsible-row[group="+group+"]").show();$(ele).attr("state","expanded");}if(tableID === 'chat-recent-tb'){var expandedGroups = [];$(".table-group-row[state=expanded]").each(function(){var groupName = $(this).attr("group");expandedGroups.push(groupName);});$.get('./data_api/set_setting.php?varname=chat_expanded_groups&varval=' + expandedGroups,function (data){});}}function SelectCommentElement(ele){var sGUID = $(ele).attr("guid");var sCommentID = $(ele).attr("commentid");var sResType = $(ele).attr("restype");var sLinkType = '';var sObjectHyper = '';if ( sGUID !== '' ){if($("#collab-comments-left").is(":visible")){$.ajax({type:"POST",cache:false,url:"mainproperties.php",data:{objectguid:sGUID,restype:sResType,linktype:sLinkType,hyper:sObjectHyper,commentid:sCommentID},beforeSend:function(){$(".collab-left-overlay").show();},success:function(sHTML){$("#collab-comments-left").html(sHTML);ShowSection('comments');LoadServerSystemoutput();},error:function(jqXHR){Write2Console('LoadMinipropsObject:' + jqXHR.statusText);},complete:function(){$(".collab-left-overlay").hide();}});}else{LoadDiagramObject(sGUID,false);}}}function SelectDiscussionElement(ele){var sGUID = $(ele).attr("guid");var sResType = $(ele).attr("restype");var sLinkType = '';var sObjectHyper = '';if ( sGUID !== '' ){if($("#collab-discussions-left").is(":visible")){$.ajax({type:"POST",cache:false,url:"mainproperties.php",data:{objectguid:sGUID,restype:sResType,linktype:sLinkType,hyper:sObjectHyper},beforeSend:function(){$(".collab-left-overlay").show();},success:function(sHTML){$("#collab-discussions-left").html(sHTML);ShowSection('discussions');LoadServerSystemoutput();},error:function(jqXHR){Write2Console('LoadMinipropsObject:' + jqXHR.statusText);},complete:function(){$(".collab-left-overlay").hide();}});}else{LoadObject(sGUID,false,'','','','',true);}}}function SelectReviewElement(ele){var sGUID = $(ele).attr("guid");var sResType = $(ele).attr("restype");var sLinkType = '';var sObjectHyper = '';if ( sGUID !== '' ){if($("#collab-reviews-left").is(":visible")){$.ajax({type:"POST",cache:false,url:"mainproperties.php",data:{objectguid:sGUID,restype:sResType,linktype:sLinkType,hyper:sObjectHyper},beforeSend:function(){$(".collab-left-overlay").show();},success:function(sHTML){$("#collab-reviews-left").html(sHTML);ShowSection('reviews');LoadServerSystemoutput();},error:function(jqXHR){Write2Console('LoadMinipropsObject:' + jqXHR.statusText);},complete:function(){$(".collab-left-overlay").hide();}});}else{LoadObject(sGUID,false,'','','','',true);}}}function HighlightElementOnClick(){$("area").click(function(){var sCoords = $(this).attr("coords");var aCoords = sCoords.split(',');var sHref = $(this).attr("href");var aHref = sHref.split('\'');var sGUID = aHref[1];var x = Number(aCoords[0]) - 2;var y = Number(aCoords[1]) + 8;var width = aCoords[2] - aCoords[0] + 4;var height = aCoords[3] - aCoords[1] + 4;var imgHeight = $("#diagram-image").height();var imgWidth = $("#diagram-image").width();$("#svg-overlay").attr("guid",sGUID);$("#svg-overlay").attr("height",imgHeight);$("#svg-overlay").attr("width",imgWidth);$("#svg-overlay").html('<rect x="'+x+'" y="'+y+'" width="'+width+'" height="'+height+'" style="fill-opacity:0;stroke-width:5;stroke:rgb(162,205,255);stroke-opacity:0.5;" />');});}function DownloadFile(ele){var guid = $(ele).attr("guid");window.location = './data_api/dl_internal_artifact.php?guid='+guid;}