/* --------------------------------------------------------
    This is a part of the Sparx Systems Pro Cloud Server.
    Copyright (C) Sparx Systems Pty Ltd
    All rights reserved.
  
    This source code can be used only under terms and 
    conditions of the accompanying license agreement.
   -------------------------------------------------------- */
window.onload = function (){if (performance.navigation.type == 1){sReloadPage = sessionStorage.getItem("current_page");sReloadAction = sessionStorage.getItem("current_action");sReloadID = sessionStorage.getItem("current_id");loadConfigPage(sReloadPage,sReloadAction,sReloadID,false);}};function loadConfigPage(sPage,sAction,sID,bAdd2History,bPromptUnsaved){sessionStorage.setItem("current_page",sPage);sessionStorage.setItem("current_action",sAction);sessionStorage.setItem("current_id",sID);if (bPromptUnsaved === undefined)bPromptUnsaved = false;if (bPromptUnsaved === true){if(bIsDirty === true){sButtons = '<div class="webea-prompt-buttons"><button class="button button-ok" onclick="discardChanges(\''+sPage+'\')">OK</button><button class="button button-ok" onclick="OnClickClosePopupDialog(\'#webea-prompt-dialog\')">Cancel</button></div>';webea_prompt('This page contains unsaved changes.<br><br>Click Ok to continue and discard the unsaved changes.<br>Click Cancel to remain on the current page.<br><br>','Warning',sButtons);return;}}if (bAdd2History === undefined)bAdd2History = true;sPayload = 'load_page=' + sPage;if (sAction !== undefined)sPayload += '&action=' + sAction;if (sID !== undefined)sPayload += '&id=' + sID;$.ajax({type:"POST",cache:false,url:"main-contents.php",data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function (response){$(".main-contents").html(response);if ( bAdd2History ){historyAdd(sPage,sAction,sID);}},error:function(jqXHR){},complete:function(){$("#main-busy-loader1").hide();}});}function onFormSubmit(event,form,action){if (event !== ''){event.preventDefault();}if (typeof bIsDirty !== 'undefined'){if (!bIsDirty){loadSuccessPage(action);return;}}if (action === "addmodelconnection"){var str = $('#config-fb-new').val();if (/^[a-zA-Z0-9 .-]*$/.test(str) == false){webea_error_message('Invalid File Name. Please enter a name which does not contain special characters.');return;}}else if (action === "addport"){var aInUse = JSON.parse($('#config-ports-inuse').val());var sPort = $("[name=port]").val();if (jQuery.inArray(sPort,aInUse) != -1){webea_error_message('A Port has already been defined with this number. Please use a different value.');return;}}else if (action === "savemodelconnection"){var startTime = $("[name=chartgen-start]").val();var valid = (startTime.search(/^\d{2}:\d{2}$/) != -1) &&(startTime.substr(0,2) >= 0 && startTime.substr(0,2) <= 24) &&(startTime.substr(3,2) >= 0 && startTime.substr(3,2) <= 59);if(!valid){webea_error_message('Invalid Scheduled Task Start Time. Please enter a time in 24hr format (HH:MM).');return;}}else if (action === "addlicensecert"){var fileName= $("[name=file]").val();var ext = fileName.match(/\.([^\.]+)$/)[1];ext = ext.toLowerCase();if (ext !== 'crt' &&ext !== 'lic'){webea_error_message('Invalid file type. Please select a .LIC or .CRT file.');return;}}else if (action === "savelicenseallocs"){var bInvalidAllocation = false;var sbpi = $("#token-alloc-integration-list");var sbpiprovidersmarked = "";bFirst = true;$('#token-alloc-integration-list > div > input').each(function (){if ($(this).is(':checked')){if(bFirst){bFirst = false;}else{sbpiprovidersmarked += ',';}sbpiprovidersmarked += this.name;}});$("[name=sbpiprovidersmarked]").val(sbpiprovidersmarked);$("#config-license-allocations-form:input[type=text]").each(function(){var str = $(this).val();if (/^[0-9]*$/.test(str) == false){bInvalidAllocation = true;}});if (bInvalidAllocation){webea_error_message('Invalid Allocation Number');$("#reload").val(0);return;}var integrationCost = $("#integration-cost").html();var integrationTokens = 0;if($("#enable-integration").is(":checked")){integrationTokens = integrationCost;}var totalTokens = parseInt($("#total-tokens").html());var totalEntered = parseInt($("[name=webeaallocated]").val()) + parseInt($("[name=prolaballocated]").val()) + parseInt(integrationTokens);if (totalEntered > totalTokens){webea_error_message('Error:The sum of reserved tokens ('+totalEntered+') cannot be more than the Total Token count ('+totalTokens+')');$("#reload").val(0);return;}if ((parseInt($("[name=promodelsmax]").val()) < parseInt($("[name=promodelsallocated]").val())) ||(parseInt($("[name=webeamax]").val()) < parseInt($("[name=webeaallocated]").val())) ||(parseInt($("[name=prolabmax]").val()) < parseInt($("[name=prolaballocated]").val()))){webea_error_message('Error:Max Allowed cannot be less than the number Reserved');$("#reload").val(0);return;}}else if (action === 'saveserverinfo'){isFirst = true;var whitelist = '';$("#whitelist-table > tbody > tr:not(:last-child) > td:first-child").each(function(){$this = $(this);if(!isFirst){whitelist += '|';}whitelist += $this.text();isFirst = false;});$("[name=admin-white-list]").val(whitelist);}var sPayload = 'action='+action+'&' + $(form).serialize();var requestSettings ={type:'POST',url:'update-settings.php',data:sPayload,beforeSend:function(){$("#main-busy-loader1").show();},success:function(response){processResponse(response,action);},complete:function(){$("#main-busy-loader1").hide();},error:function(jqXHR){webea_error_message(jqXHR.responseText);}};$.ajax(requestSettings);}function onClickButton(sAction,sData){sPayload = '';sPayload += '&action=' + sAction;sPayload += '&data=' + sData;if(sAction === 'loadchangepwd'){onFormSubmit('','#config-server-info-form','loadchangepwd');return;}else if(sAction === 'loadpcslicense'){onFormSubmit('','#config-server-info-form','loadpcslicense');return;}else if (sAction == 'deletelicensecertprompt'){sButtons = '<div class="webea-prompt-buttons"><button class="button button-ok" onclick="onClickButton(\'deletelicensecert\',\''+sData+'\')">Yes</button><button class="button button-ok" onclick="OnClickClosePopupDialog(\'#webea-prompt-dialog\')">No</button></div>';webea_prompt('Are you sure you want to delete this license?<br><br>Click Yes to delete the license.<br>Click No to cancel.<br><br>','Warning',sButtons);return;}else if (sAction == 'deletelicensecert'){OnClickClosePopupDialog('#webea-prompt-dialog');}else if (sAction == 'addsbpiprovidercustomprop'){var tblCPT = document.getElementById("custom-props-table");if ( tblCPT != null){var row = tblCPT.insertRow(tblCPT.rows.length - 1);var cell1 = row.insertCell(0);var cell2 = row.insertCell(1);var cell3 = row.insertCell(2);var cell4 = row.insertCell(3);cell1.innerHTML = '';cell2.innerHTML = '<input class="textfield-90" id="custompropitem" name="custompropitem" required="" title="Enter the Item name of the new Custom Property" onkeypress="OnPressEnter(event,\'#accept-custom-prop\')">';cell3.innerHTML = '<input class="textfield-90" id="custompropvalue" name="custompropvalue" required="" title="Enter the Value of the new Custom Property" onkeypress="OnPressEnter(event,\'#accept-custom-prop\')">';cell4.innerHTML = '<img alt="" id="accept-custom-prop" class="config-icon" title="Accept New Custom Property" onclick="onClickButton(\'acceptsbpiprovidercustomprop\',\'-1\')" src="images/tick.png">' +'<img alt="" class="config-icon" title="Cancel New Custom Property" onclick="onClickButton(\'cancelsbpiprovidercustomprop\',\'\')" src="images/delete.png">';var trLast = tblCPT.rows[tblCPT.rows.length-1];trLast.style.display = 'none';var elesToHide = document.getElementsByClassName("customprop-actionbtn");for(var i = 0;i < elesToHide.length;i++){elesToHide[i].style.display = "none";}document.getElementById("custompropitem").focus();}return;}else if (sAction == 'acceptsbpiprovidercustomprop'){var eleCustomProp = document.getElementById("customproperties");var sJSON = [];if ( typeof(eleCustomProp) != 'undefined' && eleCustomProp != null ){sJSON = eleCustomProp.value;}var oJSON = JSON.parse(sJSON);if ( oJSON !== null){var sNewItem = document.getElementById("custompropitem").value;var sNewValue = document.getElementById("custompropvalue").value;var iRow = parseInt(sData);if ( iRow == -1 ){oJSON[sNewItem] = sNewValue;sJSONOut = JSON.stringify(oJSON);document.getElementById("customproperties").value = sJSONOut;bIsDirty = true;refreshCustomPropertiesList();}if ( iRow >= 0 ){var iR = 0;var oNewJSON ={};for (key in oJSON){if (iR == iRow){oNewJSON[sNewItem] = sNewValue;}else{var sOldItem = key;var sOldValue = oJSON[key];oNewJSON[sOldItem] = sOldValue;}iR++;}sJSONOut = JSON.stringify(oNewJSON);document.getElementById("customproperties").value = sJSONOut;bIsDirty = true;refreshCustomPropertiesList();}}return;}else if (sAction == 'cancelsbpiprovidercustomprop'){refreshCustomPropertiesList();return;}else if (sAction == 'editsbpiprovidercustomprop'){var tblCPT = document.getElementById("custom-props-table");if ( tblCPT != null){var iRow = parseInt(sData);if ( iRow >= 0 && iRow < tblCPT.rows.length ){iRow++;var trEdit = tblCPT.rows[iRow];if ( trEdit !== null ){var sItem = trEdit.cells[1].innerHTML;var sValue = trEdit.cells[2].innerHTML;trEdit.cells[1].innerHTML = '<input class="textfield-90" id="custompropitem" name="custompropitem" value="' + sItem + '" required="" title="Update the Item name of the Custom Property" onkeypress="OnPressEnter(event,\'#accept-custom-prop\')">';trEdit.cells[2].innerHTML = '<input class="textfield-90" id="custompropvalue" name="custompropvalue" value="' + sValue + '"required="" title="Update the Value of the Custom Property" onkeypress="OnPressEnter(event,\'#accept-custom-prop\')">';trEdit.cells[3].innerHTML = '<img alt="" id="accept-custom-prop" class="config-icon" title="Accept New Custom Property" onclick="onClickButton(\'acceptsbpiprovidercustomprop\',\'' + (iRow-1) + ' \')" src="images/tick.png">' +'<img alt="" class="config-icon" title="Cancel New Custom Property" onclick="onClickButton(\'cancelsbpiprovidercustomprop\',\'\')" src="images/delete.png">';var trLast = tblCPT.rows[tblCPT.rows.length-1];trLast.style.display = 'none';var elesToHide = document.getElementsByClassName("customprop-actionbtn");for(var i = 0;i < elesToHide.length;i++){elesToHide[i].style.display = "none";}}elseconsole.log('table row is null');}elseconsole.log('tried to edit a table row out of bounds ' + iRow);}return;}else if (sAction == 'deletesbpiprovidercustomprop'){var sJSON = document.getElementById("customproperties").value;var oJSON = JSON.parse(sJSON);if ( oJSON !== null){var iRow = parseInt(sData);if ( iRow >= 0 ){var iR = 0;for (key in oJSON){if (iR == iRow){delete oJSON[key];}iR++;}if ( oJSON !== null ){sJSONOut = JSON.stringify(oJSON);document.getElementById("customproperties").value = sJSONOut;bIsDirty = true;refreshCustomPropertiesList();}}}return;}$.ajax({type:"POST",cache:false,url:"update-settings.php",data:sPayload,success:function (response){processResponse(response,sAction);},error:function(jqXHR){},complete:function(){}});}function processResponse(response,action){response = response.trim();var xmlDoc = $.parseXML(response);var xml = $( xmlDoc );var returnCode = xml.find( "return-code" );var returnMessage = xml.find( "return-message" );if ((returnCode.text() == '0') || (returnCode.text() == '12')){if (action == 'addflskey'){loadConfigPage('floating-licenses.php');webea_alert(returnMessage.text(),"Keys Updated");}else if (action == 'createlicenserequest'){bIsDirty = false;window.location.replace("pcs-license-req-file.php");}else if (action == 'exportconfig'){bIsDirty = false;window.location.replace("pcs-config-export.php");}else{webea_success_message(returnMessage.text());loadSuccessPage(action);}}else{webea_error_message('Error:' + returnMessage.text());}}function loadSuccessPage(action){if (action == 'addport' || action == 'saveport'){loadConfigPage('ports.php');}else if(action == 'savepcslicense'){loadConfigPage('pcs-licenses.php');}else if(action == 'addmodelconnection'){loadConfigPage('home.php');}else if(action == 'saveserverpwd'){onClickButton('logout','logout')}else if((action == 'saveflsconfig')){loadConfigPage('floating-licenses.php');}else if((action == 'savesbpiprovider') || (action == 'savesbpibindings') || (action == 'savesbpi')){loadConfigPage('integrations.php');}else if (action == 'login'){loadConfigPage('home.php');}else if (action == 'deleteport'){loadConfigPage('ports.php');}else if (action == 'deletepcslicense'){loadConfigPage('pcs-licenses.php');}else if (action == 'deletelicensecert'){loadConfigPage('pcs-licenses.php');}else if (action == 'deletemodelconnection'){loadConfigPage('home.php');}else if (action == 'deletesbpiprovider'){loadConfigPage('integrations.php');}else if((action == 'deleteflskey') || (action == 'checkinflskey')){loadConfigPage('floating-licenses.php');}else if (action == 'logout'){window.location.href = 'index.php?used_logout=true';}else if (action == 'loadchangepwd'){loadConfigPage('change-password.php');}else if ((action == 'loadpcslicense') || (action == 'addlicensecert')){loadConfigPage('pcs-licenses.php');}else if (action == 'savelicenseallocs'){if($("#reload").val() === '1'){$("#reload").val(0);loadConfigPage('allocate-tokens.php');}else{loadConfigPage('pcs-licenses.php');}}else if (action == 'createlicenserequest'){loadConfigPage('pcs-new-license-request.php');}else if ((action === 'addflsgroup') || (action === 'deleteflsgroup') || (action === 'saveflsgroup')){loadConfigPage('fls-groups.php');}else{loadConfigPage('home.php');}}function historyAdd(sPage,sAction,sID){if (sPage===''){sPage = 'home.php';}var a ={};a['page'] = sPage;a['action'] = sAction;a['id'] = sID;var sDisplayName = 'Pro Cloud Configuration';document.title = sDisplayName;if (typeof history.pushState != 'undefined'){window.history.pushState(a,sDisplayName,'index.php');}}function onIndexPopState(event){if (event.state !== null){var sPage = event.state.page;var sAction = event.state.action;var sID = event.state.id;loadConfigPage(sPage,sAction,sID,false);}else{loadConfigPage('home.php',null,null,false);}}function onSelectProvider(ele,bIsEdit,sbpiObj){var selection = $(ele).find(":selected").val();var sbpiJSON = $("#sbpi-json").html();var sbpiObj = JSON.parse(sbpiJSON);if (bIsEdit){selection = $("[name=typekey]").find(":selected").val();console.log(selection);}$.each(sbpiObj,function(index,value){if (value.key === selection){key = value.key;prefix = value.prefix;path = "C:\\Program Files (x86)\\Sparx Systems\\Pro Cloud Server\\SBPI\\" + value.exename;config = value.config;rserver = value.rserver;rprotocol = value.protocol;rserver = value.server;rport = value.port;baseurl = value.baseurl;customdllpath = value.customdllpath;customproperties = value.defaultcustomprops;supportscreds = value.supportscreds;supportsproviderdetails = value.supportsproviderdetails;readonlyprefix = value.readonlyprefix;supportscustomdll = value.supportscustomdll;supportscustomprops = value.supportscustomprops;supportsgroup = value.supportsgroup;}});if (bIsEdit !== true){$("[name=prefix]").val(prefix);$("[name=path]").val(path);$("[name=config]").val(config);$("[name=rserver]").val(rserver);$("[name=rprotocol]").val(rprotocol);$("[name=rserver]").val(rserver);$("[name=rport]").val(rport);$("[name=rbaseurl]").val(baseurl);refreshURL();}if (supportscreds === "false"){$("#config-integration-username").hide();$("#config-integration-password").hide();}else{$("#config-integration-username").show();$("#config-integration-password").show();}if (supportsproviderdetails === "false"){$(".provider-section").hide();$("#config-sbpi-prov-server").attr('disabled',true);}else{$(".provider-section").show();$("#config-sbpi-prov-server").attr('disabled',false);}if (supportscustomdll === "true"){$(".supports-custom-dll").show();$(".supports-custom-dll").attr('disabled',false);if (bIsEdit !== true){$("[name=customdllpath]").val(customdllpath);}}else{$(".supports-custom-dll").hide();$(".supports-custom-dll").attr('disabled',true);}if (supportscustomprops === "true"){$(".supports-custom-props").show();$(".supports-custom-props").attr('disabled',false);if (customproperties === ''){customproperties = '{}';}if (bIsEdit !== true){$("[name=customproperties]").val(customproperties);}refreshCustomPropertiesList();}else{$(".supports-custom-props").hide();$(".supports-custom-props").attr('disabled',true);}if (supportsgroup === "true"){$(".supports-group").show();$(".supports-group").attr('disabled',false);}else{$(".supports-group").hide();$(".supports-group").attr('disabled',true);}if(readonlyprefix === "true"){$("[name=prefix]").attr('readonly','readonly');}else{$("[name=prefix]").removeAttr('readonly');}selectedProtocol = $("[name=rprotocol]");onSelectProviderProtocol(selectedProtocol);}function onSelectProviderProtocol(ele){if ($(ele).find(":selected").val() === 'https'){$(".config-sbpi-prov-ignoressl").show();}else{$(".config-sbpi-prov-ignoressl").hide();}}function onSelectPortAuth(ele){if ($(ele).find(":selected").val() == 'Global'){$("#config-port-auth-model").prop('disabled',false);}else{$("#config-port-auth-model").prop('disabled',true);}}function webea_success_message(sText){if ((sText.length > 2000) && ((sText.includes("<tr>")==true))){sText = 'Error:Invalid message format,see browser console for details';}else{}if (sText !== null && sText !== ''){$( "#webea-success-message" ).stop();$( "#webea-success-message" ).hide();$( "#webea-error-message" ).stop();$( "#webea-error-message" ).hide();$( "#webea-success-message-text" ).html(sText);$( "#webea-success-message" ).fadeIn(300);}$("#webea-success-message").delay(3000).fadeOut(300);}function webea_error_message(sText){if ((sText.length > 2000) && ((sText.includes("<tr>")==true))){sText = 'Error:Invalid message format,see browser console for details';}else{sText = str_trim(sText);}if (sText !== null && sText !== ''){$( "#webea-success-message" ).stop();$( "#webea-success-message" ).hide();$( "#webea-error-message" ).stop();$( "#webea-error-message" ).hide();$( "#webea-error-message-text" ).html(sText);$( "#webea-error-message" ).fadeIn(300);}$("#webea-error-message").delay(5000).fadeOut(300);}function str_trim(str){str = String(str);if ( str != ''){str = str.replace(/^\s+|\s+$/gm,'');}return str;}function collapse(ele){if (($(ele).hasClass("collapsed-icon")) || ($(ele).hasClass("expanded-icon"))){ele = $(ele).next();}$(ele).next().toggle();if ($(ele).hasClass("collapsed")){$(ele).removeClass("collapsed");}else{$(ele).addClass("collapsed");}iconImg = $(ele).prev();if (iconImg.hasClass("collapsed-icon")){iconImg.addClass("expanded-icon").removeClass("collapsed-icon");}else if (iconImg.hasClass("expanded-icon")){iconImg.addClass("collapsed-icon").removeClass("expanded-icon");}}function onClickSelectType(){dbtype = $('input[name=db-type]:checked').val();driver = $('input[name=db-type]:checked').next().next().val();loadConfigPage('dbmanager-add.php',driver,dbtype);}function onClickFirebirdSelection(ele){selection = $(ele).attr('id');if (selection == "config-new-firebird"){$("#config-fb-new").prop('disabled',false);$("#config-fb-existing").prop('disabled',true);}else if (selection == "config-existing-firebird"){$("#config-fb-new").prop('disabled',true);$("#config-fb-existing").prop('disabled',false);}}function selectRadio(ele){$(ele).prev().click();}function onClickLogout(){loadConfigPage('login.php');}function webea_alert(sText,sTitle){var sConsoleStr = '';if (sText !== null && sText !== ''){if (typeof sTitle !== 'undefined' && sTitle !== '' ){$( "#webea-messagebox-title-text" ).text(sTitle);sConsoleStr = sTitle + ' ';}$( "#webea-messagebox-line-value-message" ).html(sText);$( "#main-page-overlay" ).show();$( "#webea-messagebox-dialog" ).show();}}function webea_prompt(sText,sTitle,sButtons){var sConsoleStr = '';if (sText !== null && sText !== ''){if (typeof sTitle !== 'undefined' && sTitle !== '' ){$( "#webea-prompt-title-text" ).text(sTitle);sConsoleStr = sTitle + ' ';}$( "#webea-prompt-line-value-message" ).html(sText);$( "#webea-prompt-buttons" ).html(sButtons);$( "#main-page-overlay" ).show();$( "#webea-prompt-dialog" ).show();}}function discardChanges(sPage){$( "#main-page-overlay" ).hide();$( "#webea-prompt-dialog" ).hide();loadConfigPage(sPage);}function OnClickClosePopupDialog(sDialogName){$( "#main-page-overlay" ).hide();$( sDialogName ).hide();}function onSelectPortProtocol(ele){selection = $(ele).find(":selected").val();if (selection == 'http'){$("[name=tlsv1-3]").prop('disabled',true);$("[name=tlsv1-2]").prop('disabled',true);$("[name=tlsv1-1]").prop('disabled',true);$("[name=tlsv1-0]").prop('disabled',true);$("[name=sslv3]").prop('disabled',true);$("#config-tls-versions").addClass("tls-disabled");}else{$("[name=tlsv1-3]").prop('disabled',false);$("[name=tlsv1-2]").prop('disabled',false);$("[name=tlsv1-1]").prop('disabled',false);$("[name=tlsv1-0]").prop('disabled',false);$("[name=sslv3]").prop('disabled',false);$("#config-tls-versions").removeClass("tls-disabled");}}function onSelectUseProxy(ele){bIsChecked = $(ele).prop('checked');if(bIsChecked){$("#config-sbpi-proxyurl:first-child").show();$("[name=server]").attr('title','The server name (or IP) that hosts the Integration Server. While using a Proxy this name must be resolvable by the Pro Cloud Server.');}else{$("#config-sbpi-proxyurl:first-child").hide();$("[name=server]").attr('title','The server name (or IP) that hosts the Integration Server. This name must be resolvable by the Enterprise Architect clients.');}}function onSelectAutoDiscover(ele){bIsChecked = $(ele).prop('checked');if(bIsChecked){$(".config-sbpi-fallback").html('Fallback URL');}else{$(".config-sbpi-fallback").html('Absolute URL');}}function onSelectUseLegacy(ele){bIsChecked = $(ele).prop('checked');if(bIsChecked){$(".config-legacy-settings").show();$("#sbpilocalport").parent().hide();}else{$(".config-legacy-settings").hide();$("#sbpilocalport").parent().show();}}function onSelectEnableWorker(ele){bIsChecked = $(ele).prop('checked');if(bIsChecked){$("[name=worker-connection-port-protocol]").prop('disabled',false);$("[name=worker-connection-user]").prop('disabled',false);$("[name=worker-connection-pwd]").prop('disabled',false);$("[name=worker-update-period]").prop('disabled',false);$("[name=worker-logging-level]").prop('disabled',false);}else{$("[name=worker-connection-port-protocol]").prop('disabled',true);$("[name=worker-connection-user]").prop('disabled',true);$("[name=worker-connection-pwd]").prop('disabled',true);$("[name=worker-update-period]").prop('disabled',true);$("[name=worker-logging-level]").prop('disabled',true);}}function onSelectEnableScheduledTasks(ele){bIsChecked = $(ele).prop('checked');if(bIsChecked){$(".chartgen-field").prop('disabled',false);}else{$(".chartgen-field").prop('disabled',true);}}function setValue(ele,val){bIsDirty = true;$(ele).val(val);}function setSBPIDefaults(ele,val){bIsDirty = true;if ($(ele).val()===''){$(ele).val(val);}if ($("[name=server]").val()===''){$("[name=server]").val('localhost');}if ($("[name=port]").val()===''){$("[name=port]").val('8080');}}function onChangeTokens(ele){alertString = "";val = $(ele).val();modelsCount = Math.floor(val / 5);if (/^[0-9]*$/.test(val) == false){alertString = "<img alt=\"\" style=\"vertical-align:top;\" title=\"Invalid Allocation Number.\" src=\"images/alert.png\"> ";modelCountString = "";}else if ((val === '') && ($(ele).hasClass("textfield-token-max"))){alertString = "";modelCountString = "";}else{if (($(ele).attr('name') === "promodelsallocated") || ($(ele).attr('name') === "promodelsmax")){remainder = val % 5;if (remainder !== 0){alertString = "<img alt=\"\" style=\"vertical-align:top;\" title=\"Number of tokens allocated should be a multiple of 5.\" src=\"images/alert.png\"> ";}modelCountString = "(" + modelsCount + " models)";}else{alertString = "";modelCountString = "";}}modelsText = alertString + modelCountString;$(ele).next().html(modelsText);}function OnLoad_DatePickerCtrls(sCtrlsCSV){if ( sCtrlsCSV != ''){var a = sCtrlsCSV.split(",");if (a.length > 0){for (var i=0;i < a.length;i++){if ( a[i] != '' ){var a2 = a[i].split("|");var sTextField = a2[0];var sImage = a2[1];$('#' + sTextField).datepick({showOnFocus:false,showTrigger:'#' + sImage,dateFormat:'yyyy-mm-dd',showAnim:'',showSpeed:10});}}}}}function OnDateFieldLostFocus(sFieldID){var ele = document.getElementById(sFieldID);if (ele != null){var sValue = str_trim(ele.value);if ( sValue != ''){var dtNow = new Date();if (sValue.length=1 && sValue.length<=2){sValue = (dtNow.getMonth()+1).toString() + '-' + sValue;}if (sValue.length>=3 && sValue.length<=5){sValue = dtNow.getFullYear().toString() + '-' + sValue;}sValue = sValue.replace(/[\/. ]/g,'-');if (sValue.length==8 && sValue.substring(2,3)=='-' && sValue.slice(5,6)=='-'){sValue = dtNow.getFullYear().toString().substr(0,2) + sValue;}aDateParts = sValue.split('-');if (aDateParts.length == 3){if (checkdate(aDateParts[0],aDateParts[1],aDateParts[2])){var dt = new Date(aDateParts[0],aDateParts[1],aDateParts[2],0,0,0,0);sValue = dt.getFullYear() + '-' + ('0' + dt.getMonth()).slice(-2) + '-' + ('0' + dt.getDate()).slice(-2);}}if (sValue != ele.value){ele.value = sValue;}}}}function CopyText(inputID){var copyText = document.getElementById(inputID);$(copyText).show();copyText.select();document.execCommand("copy");$(copyText).hide();webea_success_message('Copied text to Clipboard');}function ShowWhitelistPrompt(){sButtons = '<div class="webea-prompt-buttons"><button class="button button-ok" id="add-ip-ok-button" onclick="WhitelistAddIP()">OK</button><button class="button button-cancel" onclick="OnClickClosePopupDialog(\'#webea-prompt-dialog\')">Cancel</button></div>';webea_prompt('Enter an IP address to add to the Pro Cloud Configuration White List.<br><br><input class="webea-dialog-textarea" id="webconfig-ip-textarea" type="text" onkeypress="OnPressEnter(event,\'#add-ip-ok-button\')">','Add Authorized Client Address',sButtons);$("#webconfig-ip-textarea").select();}function WhitelistAddIP(){bIsDirty = true;input= $("#webconfig-ip-textarea").val();$('#whitelist-table tr:last').before('<tr><td>'+input+'</td><td><img alt="" class="config-icon" src="images/delete.png" title="Remove IP Address" onclick="RemoveTableRow(this)"></td></tr>');OnClickClosePopupDialog('#webea-prompt-dialog');}function RemoveTableRow(ele){bIsDirty = true;$(ele).parent().parent('tr').remove();}function OnPressEnter(event,button){if (event){if (event.keyCode === 13){$(button).click();return false;}}return true;}function refreshCustomPropertiesList(){var sJSON = document.getElementById("customproperties").value;var oJSON = JSON.parse(sJSON);if ( !oJSON !== null){var tblCPT = document.getElementById("custom-props-table");if ( tblCPT != null){for (var i = tblCPT.rows.length-1;i > 0;i--){tblCPT.deleteRow(i);}var iR = 0;Object.keys(oJSON).forEach(function(key){var row = tblCPT.insertRow(tblCPT.rows.length);var cell1 = row.insertCell(0);var cell2 = row.insertCell(1);var cell3 = row.insertCell(2);var cell4 = row.insertCell(3);cell1.innerHTML = '';cell2.innerHTML = key;cell3.innerHTML = oJSON[key];cell4.innerHTML = '<img alt="" class="config-icon customprop-actionbtn" title="Edit Custom Property" onclick="onClickButton(\'editsbpiprovidercustomprop\',\'' + iR + '\')" src="images/edit.png">' +'<img alt="" class="config-icon customprop-actionbtn" title="Delete Custom Property" onclick="onClickButton(\'deletesbpiprovidercustomprop\',\'' + iR + '\')" src="images/delete.png">';iR++;});var row = tblCPT.insertRow(tblCPT.rows.length);var cell1 = row.insertCell(0);var cell2 = row.insertCell(1);var cell3 = row.insertCell(2);var cell4 = row.insertCell(3);cell1.innerHTML = '<img alt="" class="config-add-icon" src="images/add.png">';cell2.innerHTML = '<a class="w3-link" onclick="onClickButton(\'addsbpiprovidercustomprop\',\'\') ">&lt;Add a Custom Property&gt;</a>';cell3.innerHTML = '';cell4.innerHTML = '';}}}function ShowFLSGroupEntitlementDialog(addOrEdit,rowID){if ($("#fls-add-group-ent-button").hasClass("disabled")){return;}$("[name=row-id]").val(rowID);var heading = $("#fls-entitlements-dialog").children().first().children().first();if (addOrEdit === 'add'){heading.html('Add Group License Entitlement');$("[name=product]").val('Desktop');$("[name=isacademic]").prop('checked',false);$("[name=limit]").val('');}else if (addOrEdit === 'edit'){heading.html('Edit Group License Entitlement');var tableRow = $(rowID);var product = tableRow.children().eq(0).html();var license = tableRow.children().eq(1).html();var limit = tableRow.children().eq(2).html();$("[name=product]").val(product);if (license === 'Full'){$("[name=isacademic]").prop('checked',false);}else if (license === 'Academic'){$("[name=isacademic]").prop('checked',true);}else{$("[name=isacademic]").prop('checked',false);}$("[name=limit]").val(limit);console.log(tableRow);console.log(product);}$("#fls-entitlements-dialog").show();}function FLSGroupAddEntitlement(){var rowID = $("[name=row-id]").val();var isEdit = false;if (rowID !== ''){isEdit = true;}var product = $("[name=product]").val();var isacademic = $("[name=isacademic]").is(':checked');var limit = $("[name=limit]").val();var license;if (isacademic){license = 'Academic';}else{license = 'Full';}var newID = '#ent-row-' + product + '-' + license;var selectedProductLic = product + ' - ' + license;var entExistsError = 'Entitlement for \''+selectedProductLic + '\' already exists';var actions = '<img alt="" class="config-icon" src="images/edit.png" title="Edit Group" onclick="ShowFLSGroupEntitlementDialog(\'edit\',\'#ent-row-'+product+'-'+license+'\')">';actions += '<img alt="" class="config-icon" src="images/delete.png" title="Delete Group" onclick="FLSGroupDeleteEntitlement(\'#ent-row-'+product+'-'+license+'\')">';var newRowHTML = '<tr id="ent-row-'+product+'-'+license+'"><td>'+product+'</td><td>'+license+'</td><td>'+limit+'</td><td>'+actions+'</td></tr>';if (isEdit){if (rowID === newID){$(rowID).children().eq(2).html(limit);UpdateEntitlementsXMLFromTable();OnClickClosePopupDialog('#fls-entitlements-dialog');}else{if( $(newID).length ){webea_error_message(entExistsError);}else{$(rowID).replaceWith(newRowHTML);UpdateEntitlementsXMLFromTable();OnClickClosePopupDialog('#fls-entitlements-dialog');}}}else{if( $(newID).length ){webea_error_message(entExistsError);}else{$('#entitlements-table tr:last').before(newRowHTML);UpdateEntitlementsXMLFromTable();OnClickClosePopupDialog('#fls-entitlements-dialog');}}}function FLSGroupDeleteEntitlement(rowID){$(rowID).replaceWith('');UpdateEntitlementsXMLFromTable();}function UpdateEntitlementsXMLFromTable(){var isFirst = true;var entitlementXML = '';var product,license,limit,isacademic;$("#entitlements-table > tbody > tr:not(:last-child)").each(function(){$this = $(this);if(!isFirst){license = $(this).children().eq(1).text();if (license === 'Full'){isacademic = 'false';}else{isacademic = 'true';}product = '<product>' + $(this).children().eq(0).text() + '</product>';isacademic = '<isacademic>' + isacademic + '</isacademic>';limit = '<limit>' + $(this).children().eq(2).text() + '</limit>';entitlementXML += '<entitlement>' + product + isacademic + limit +'</entitlement>';}isFirst = false;});$("[name=entitlements]").val(entitlementXML);}function onSelectIsAdmin(ele){bIsChecked = $(ele).prop('checked');if(bIsChecked){$("[name=activation]").prop('disabled',true);$("[name=ad-groups]").prop('disabled',true);$("#fls-add-group-ent-button").addClass("disabled");}else{$("[name=activation]").prop('disabled',false);$("[name=ad-groups]").prop('disabled',false);$("#fls-add-group-ent-button").prop('disabled',false);$("#fls-add-group-ent-button").removeClass("disabled");}}